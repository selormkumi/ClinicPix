import{a as Z}from"./chunk-BQYRHPAA.js";import{a as y}from"./chunk-3M3IL3L2.js";import{a as B,b as C}from"./chunk-GI6NNGHX.js";import{b as D,f as N,i as F,t as j}from"./chunk-WFSOM37F.js";import{b as T,j as x,k as _,m as v}from"./chunk-YITIAFLR.js";import"./chunk-OTQCBJ2V.js";import{Cb as i,Db as c,Eb as z,Gb as k,Hb as P,Ib as w,Lb as X,Mb as E,Nb as U,Oa as a,Pa as l,T as K,Y as Q,Za as b,a as G,b as J,cb as g,da as S,ea as M,ec as Y,fc as I,gc as R,hc as A,ic as L,jb as m,nb as t,ob as n,pb as f,sb as W,ub as p,vb as h}from"./chunk-Z3TPZZXO.js";var O=class o{constructor(r,e){this.authService=r;this.router=e}currentUserName="User";ngOnInit(){let r=localStorage.getItem("user");if(r)try{let e=JSON.parse(r);this.currentUserName=e.userName?.trim()||e.username?.trim()||e.name?.trim()||"Unknown",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||o)(l(C),l(x))};static \u0275cmp=b({type:o,selectors:[["app-dashboard"]],decls:28,vars:0,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),p("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"h3"),i(14,"Welcome, Admin"),n(),t(15,"p"),i(16,"Monitor and manage the platform efficiently."),n()(),t(17,"div",7)(18,"div",8)(19,"h5"),i(20,"Dashboard Overview"),n(),t(21,"p"),i(22,"Welcome to the Admin Dashboard. Here you can:"),n(),t(23,"ul")(24,"li"),i(25,"Manage users efficiently."),n(),t(26,"li"),i(27,"Review audit logs for activity tracking."),n()()()()())},dependencies:[v,_],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var $=class o{constructor(r){this.http=r}baseUrl=`${B.apiUrl}/users`;getAllUsers(){return this.http.get(`${this.baseUrl}/all`)}updateUser(r,e){return this.http.put(`${this.baseUrl}/${r}`,e)}activateUser(r){return this.http.patch(`${this.baseUrl}/activate/${r}`,{})}deactivateUser(r){return this.http.patch(`${this.baseUrl}/deactivate/${r}`,{})}adminResetPassword(r,e){return this.http.post(`${B.apiUrl}/auth/admin-reset-password`,{targetEmail:r},e)}static \u0275fac=function(e){return new(e||o)(Q(T))};static \u0275prov=K({token:o,factory:o.\u0275fac,providedIn:"root"})};var de=(o,r)=>({"text-success":o,"text-danger":r});function ce(o,r){o&1&&(t(0,"div",15),f(1,"i",16),i(2," Loading users... "),n())}function le(o,r){if(o&1){let e=W();t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),n(),t(5,"td"),i(6),n(),t(7,"td"),i(8),n(),t(9,"td"),i(10),E(11,"date"),n(),t(12,"td")(13,"span",23),i(14),n()(),t(15,"td",20)(16,"div",24)(17,"button",25),p("click",function(){let d=S(e).$implicit,u=h(2);return M(u.toggleUserStatus(d))}),f(18,"i",26),i(19),n(),t(20,"button",27),p("click",function(){let d=S(e).$implicit,u=h(2);return M(u.resetPassword(d))}),f(21,"i",28),i(22," Reset Password "),n()()()()}if(o&2){let e=r.$implicit;a(2),c(e.id),a(2),c(e.username),a(2),c(e.email),a(2),c(e.role),a(2),c(U(11,10,e.date_created,"medium")),a(3),m("ngClass",X(13,de,e.is_active,!e.is_active)),a(),z(" ",e.is_active?"Active":"Inactive"," "),a(3),m("ngClass",e.is_active?"btn btn-danger btn-sm":"btn btn-success btn-sm"),a(),m("ngClass",e.is_active?"fa-user-times":"fa-user-check"),a(),z(" ",e.is_active?"Deactivate":"Activate"," ")}}function me(o,r){o&1&&(t(0,"tr")(1,"td",29),i(2,"No users found."),n()())}function pe(o,r){if(o&1&&(t(0,"div",17)(1,"table",18)(2,"thead",19)(3,"tr")(4,"th"),i(5,"User ID"),n(),t(6,"th"),i(7,"User Name"),n(),t(8,"th"),i(9,"Email"),n(),t(10,"th"),i(11,"Role"),n(),t(12,"th"),i(13,"Date Created"),n(),t(14,"th"),i(15,"Status"),n(),t(16,"th",20),i(17,"Actions"),n()()(),t(18,"tbody"),g(19,le,23,16,"tr",21)(20,me,3,0,"tr",22),n()()()),o&2){let e=h();a(19),m("ngForOf",e.filteredUsers),a(),m("ngIf",e.filteredUsers.length===0)}}function ue(o,r){if(o&1){let e=W();t(0,"div",30)(1,"div",31)(2,"h5",32),i(3,"Reset Password"),n(),t(4,"p"),i(5," Please confirm that you want to send a password reset link to:"),f(6,"br"),t(7,"strong"),i(8),n()(),t(9,"div",33)(10,"button",34),p("click",function(){S(e);let d=h();return M(d.cancelReset())}),i(11,"Cancel"),n(),t(12,"button",35),p("click",function(){S(e);let d=h();return M(d.confirmResetPassword())}),i(13,"Confirm"),n()()()()}if(o&2){let e=h();a(8),c(e.userToReset==null?null:e.userToReset.email)}}var V=class o{constructor(r,e,s,d){this.authService=r;this.router=e;this.adminService=s;this.toastr=d}searchTerm="";users=[];filteredUsers=[];isLoading=!1;showResetModal=!1;userToReset=null;ngOnInit(){this.fetchUsers()}fetchUsers(){this.isLoading=!0,this.adminService.getAllUsers().subscribe(r=>{this.users=r,this.filteredUsers=[...r],this.isLoading=!1},r=>{console.error("\u274C ERROR: Failed to fetch users",r),this.isLoading=!1})}onSearch(){let r=this.searchTerm.toLowerCase();this.filteredUsers=this.users.filter(e=>e.username.toLowerCase().includes(r)||e.email.toLowerCase().includes(r))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"])}toggleUserStatus(r){(r.is_active?this.adminService.deactivateUser:this.adminService.activateUser).call(this.adminService,r.id).subscribe({next:()=>{r.is_active=!r.is_active,this.toastr.success(`User ${r.is_active?"activated":"deactivated"} successfully`)},error:()=>{this.toastr.error("Action failed")}})}resetPassword(r){this.userToReset=r,this.showResetModal=!0}confirmResetPassword(){if(!this.userToReset)return;let r=localStorage.getItem("token");if(!r){this.toastr.error("Admin token missing. Please log in again.");return}let e={headers:{Authorization:`Bearer ${r}`}};this.adminService.adminResetPassword(this.userToReset.email,e).subscribe({next:()=>{this.toastr.success(`\u2705 Password reset link sent to ${this.userToReset.email}`),this.cancelReset()},error:s=>{console.error("\u274C Admin reset failed:",s),this.toastr.error(s.error?.message||"Reset failed"),this.cancelReset()}})}cancelReset(){this.showResetModal=!1,this.userToReset=null}static \u0275fac=function(e){return new(e||o)(l(C),l(x),l($),l(Z))};static \u0275cmp=b({type:o,selectors:[["app-manage-users"]],decls:22,vars:4,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search users...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","manage-users",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-2"],[3,"click","ngClass"],[1,"fas",3,"ngClass"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-key"],["colspan","7",1,"text-center","text-muted"],[1,"modal-backdrop"],[1,"modal-content"],[1,"modal-title"],[1,"modal-actions","mt-3","d-flex","justify-content-center","gap-3"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),p("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),w("ngModelChange",function(u){return P(s.searchTerm,u)||(s.searchTerm=u),u}),p("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),i(18,"Manage Users"),n(),g(19,ce,3,0,"div",12)(20,pe,21,2,"div",13),n()()(),g(21,ue,14,1,"div",14)),e&2&&(a(14),k("ngModel",s.searchTerm),a(5),m("ngIf",s.isLoading),a(),m("ngIf",!s.isLoading),a(),m("ngIf",s.showResetModal))},dependencies:[v,_,j,D,N,F,L,Y,I,R,A],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0006;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:10px;width:90%;max-width:400px;text-align:center;box-shadow:0 5px 20px #0000004d}"]})};var ie={production:!0,apiUrl:"https://13.58.121.1/api"};function ge(o,r){o&1&&(t(0,"div",19),f(1,"i",20),i(2," Loading logs... "),n())}function fe(o,r){if(o&1&&(t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),n(),t(5,"td"),i(6),n(),t(7,"td"),i(8),n(),t(9,"td"),i(10),n(),t(11,"td"),i(12),E(13,"date"),n(),t(14,"td",21),i(15),n()()),o&2){let e=r.$implicit;a(2),c(e.action),a(2),c(e.user_id||"N/A"),a(2),c(e.user_username||"N/A"),a(2),c(e.user_email||"N/A"),a(2),c(e.user_role||"N/A"),a(2),c(e.formattedTime||U(13,7,e.created_at,"medium")),a(3),c(e.details)}}var H=class o{constructor(r,e,s){this.authService=r;this.router=e;this.http=s}searchTerm="";auditLogs=[];filteredLogs=[];isLoading=!1;ngOnInit(){this.fetchAuditLogs()}fetchAuditLogs(){this.isLoading=!0,this.http.get(`${ie.apiUrl}/audit-logs`).subscribe(r=>{this.auditLogs=r.map(e=>J(G({},e),{formattedTime:new Date(e.timestamp).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",year:"numeric",month:"short",day:"numeric",hour12:!0})})),this.filteredLogs=[...this.auditLogs],this.isLoading=!1},r=>{console.error("\u274C Failed to load audit logs",r),this.isLoading=!1})}onSearch(){let r=this.searchTerm.toLowerCase();this.filteredLogs=this.auditLogs.filter(e=>e.action.toLowerCase().includes(r)||e.details.toLowerCase().includes(r)||e.user_email&&e.user_email.toLowerCase().includes(r)||e.user_role&&e.user_role.toLowerCase().includes(r)||e.user_username&&e.user_username.toLowerCase().includes(r)||String(e.user_id).includes(r))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||o)(l(C),l(x),l(T))};static \u0275cmp=b({type:o,selectors:[["app-audit"]],decls:40,vars:3,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search logs...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","audit-logs",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[2,"white-space","nowrap"],[2,"min-width","200px"],[4,"ngFor","ngForOf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[2,"white-space","normal","word-break","break-word"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),p("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),w("ngModelChange",function(u){return P(s.searchTerm,u)||(s.searchTerm=u),u}),p("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),i(18,"Audit Logs"),n(),g(19,ge,3,0,"div",12),t(20,"div",13)(21,"table",14)(22,"thead",15)(23,"tr")(24,"th",16),i(25,"Action"),n(),t(26,"th",16),i(27,"User ID"),n(),t(28,"th",16),i(29,"User Name"),n(),t(30,"th",16),i(31,"Email"),n(),t(32,"th",16),i(33,"Role"),n(),t(34,"th",16),i(35,"Date"),n(),t(36,"th",17),i(37,"Details"),n()()(),t(38,"tbody"),g(39,fe,16,10,"tr",18),n()()()()()()),e&2&&(a(14),k("ngModel",s.searchTerm),a(5),m("ngIf",s.isLoading),a(20),m("ngForOf",s.filteredLogs))},dependencies:[v,_,j,D,N,F,L,I,R,A],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var Fe=[{path:"",component:O,canActivate:[y],data:{role:"admin"}},{path:"dashboard",component:O,canActivate:[y],data:{role:"admin"}},{path:"manage-users",component:V,canActivate:[y],data:{role:"admin"}},{path:"audit",component:H,canActivate:[y],data:{role:"admin"}}];export{Fe as ADMIN_ROUTES};
