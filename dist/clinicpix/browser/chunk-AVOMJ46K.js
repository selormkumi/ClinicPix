import{a as X}from"./chunk-BQYRHPAA.js";import{a as y}from"./chunk-3M3IL3L2.js";import{a as z,b as v}from"./chunk-GI6NNGHX.js";import{b as T,f as D,i as N,t as F}from"./chunk-WFSOM37F.js";import{b as L,j as b,k as x,m as _}from"./chunk-YITIAFLR.js";import"./chunk-OTQCBJ2V.js";import{Cb as r,Db as c,Eb as W,Gb as k,Hb as P,Ib as w,Lb as J,Mb as E,Nb as U,Oa as a,Pa as l,T as q,Y as G,Za as f,cb as h,da as C,ea as S,ec as K,fc as R,gc as Q,hc as I,ic as A,jb as u,nb as t,ob as n,pb as M,sb as H,ub as m,vb as g}from"./chunk-Z3TPZZXO.js";var O=class o{constructor(i,e){this.authService=i;this.router=e}currentUserName="User";ngOnInit(){let i=localStorage.getItem("user");if(i)try{let e=JSON.parse(i);this.currentUserName=e.userName?.trim()||e.username?.trim()||e.name?.trim()||"Unknown",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||o)(l(v),l(b))};static \u0275cmp=f({type:o,selectors:[["app-dashboard"]],decls:28,vars:0,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),r(2,"Admin Dashboard"),n(),t(3,"a",1),r(4,"Home"),n(),t(5,"a",2),r(6,"Manage Users"),n(),t(7,"a",3),r(8,"Audit Logs"),n(),t(9,"a",4),m("click",function(){return s.logout()}),r(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"h3"),r(14,"Welcome, Admin"),n(),t(15,"p"),r(16,"Monitor and manage the platform efficiently."),n()(),t(17,"div",7)(18,"div",8)(19,"h5"),r(20,"Dashboard Overview"),n(),t(21,"p"),r(22,"Welcome to the Admin Dashboard. Here you can:"),n(),t(23,"ul")(24,"li"),r(25,"Manage users efficiently."),n(),t(26,"li"),r(27,"Review audit logs for activity tracking."),n()()()()())},dependencies:[_,x],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var j=class o{constructor(i){this.http=i}baseUrl=`${z.apiUrl}/users`;getAllUsers(){return this.http.get(`${this.baseUrl}/all`)}updateUser(i,e){return this.http.put(`${this.baseUrl}/${i}`,e)}activateUser(i){return this.http.patch(`${this.baseUrl}/activate/${i}`,{})}deactivateUser(i){return this.http.patch(`${this.baseUrl}/deactivate/${i}`,{})}adminResetPassword(i,e){return this.http.post(`${z.apiUrl}/auth/admin-reset-password`,{targetEmail:i},e)}static \u0275fac=function(e){return new(e||o)(G(L))};static \u0275prov=q({token:o,factory:o.\u0275fac,providedIn:"root"})};var ae=(o,i)=>({"text-success":o,"text-danger":i});function se(o,i){o&1&&(t(0,"div",15),M(1,"i",16),r(2," Loading users... "),n())}function de(o,i){if(o&1){let e=H();t(0,"tr")(1,"td"),r(2),n(),t(3,"td"),r(4),n(),t(5,"td"),r(6),n(),t(7,"td"),r(8),n(),t(9,"td"),r(10),E(11,"date"),n(),t(12,"td")(13,"span",23),r(14),n()(),t(15,"td",20)(16,"div",24)(17,"button",25),m("click",function(){let d=C(e).$implicit,p=g(2);return S(p.toggleUserStatus(d))}),M(18,"i",26),r(19),n(),t(20,"button",27),m("click",function(){let d=C(e).$implicit,p=g(2);return S(p.resetPassword(d))}),M(21,"i",28),r(22," Reset Password "),n()()()()}if(o&2){let e=i.$implicit;a(2),c(e.id),a(2),c(e.username),a(2),c(e.email),a(2),c(e.role),a(2),c(U(11,10,e.date_created,"medium")),a(3),u("ngClass",J(13,ae,e.is_active,!e.is_active)),a(),W(" ",e.is_active?"Active":"Inactive"," "),a(3),u("ngClass",e.is_active?"btn btn-danger btn-sm":"btn btn-success btn-sm"),a(),u("ngClass",e.is_active?"fa-user-times":"fa-user-check"),a(),W(" ",e.is_active?"Deactivate":"Activate"," ")}}function ce(o,i){o&1&&(t(0,"tr")(1,"td",29),r(2,"No users found."),n()())}function le(o,i){if(o&1&&(t(0,"div",17)(1,"table",18)(2,"thead",19)(3,"tr")(4,"th"),r(5,"User ID"),n(),t(6,"th"),r(7,"User Name"),n(),t(8,"th"),r(9,"Email"),n(),t(10,"th"),r(11,"Role"),n(),t(12,"th"),r(13,"Date Created"),n(),t(14,"th"),r(15,"Status"),n(),t(16,"th",20),r(17,"Actions"),n()()(),t(18,"tbody"),h(19,de,23,16,"tr",21)(20,ce,3,0,"tr",22),n()()()),o&2){let e=g();a(19),u("ngForOf",e.filteredUsers),a(),u("ngIf",e.filteredUsers.length===0)}}function me(o,i){if(o&1){let e=H();t(0,"div",30)(1,"div",31)(2,"h5",32),r(3,"Reset Password"),n(),t(4,"p"),r(5," Please confirm that you want to send a password reset link to:"),M(6,"br"),t(7,"strong"),r(8),n()(),t(9,"div",33)(10,"button",34),m("click",function(){C(e);let d=g();return S(d.cancelReset())}),r(11,"Cancel"),n(),t(12,"button",35),m("click",function(){C(e);let d=g();return S(d.confirmResetPassword())}),r(13,"Confirm"),n()()()()}if(o&2){let e=g();a(8),c(e.userToReset==null?null:e.userToReset.email)}}var $=class o{constructor(i,e,s,d){this.authService=i;this.router=e;this.adminService=s;this.toastr=d}searchTerm="";users=[];filteredUsers=[];isLoading=!1;showResetModal=!1;userToReset=null;ngOnInit(){this.fetchUsers()}fetchUsers(){this.isLoading=!0,this.adminService.getAllUsers().subscribe(i=>{this.users=i,this.filteredUsers=[...i],this.isLoading=!1},i=>{console.error("\u274C ERROR: Failed to fetch users",i),this.isLoading=!1})}onSearch(){let i=this.searchTerm.toLowerCase();this.filteredUsers=this.users.filter(e=>e.username.toLowerCase().includes(i)||e.email.toLowerCase().includes(i))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"])}toggleUserStatus(i){(i.is_active?this.adminService.deactivateUser:this.adminService.activateUser).call(this.adminService,i.id).subscribe({next:()=>{i.is_active=!i.is_active,this.toastr.success(`User ${i.is_active?"activated":"deactivated"} successfully`)},error:()=>{this.toastr.error("Action failed")}})}resetPassword(i){this.userToReset=i,this.showResetModal=!0}confirmResetPassword(){if(!this.userToReset)return;let i=localStorage.getItem("token");if(!i){this.toastr.error("Admin token missing. Please log in again.");return}let e={headers:{Authorization:`Bearer ${i}`}};this.adminService.adminResetPassword(this.userToReset.email,e).subscribe({next:()=>{this.toastr.success(`\u2705 Password reset link sent to ${this.userToReset.email}`),this.cancelReset()},error:s=>{console.error("\u274C Admin reset failed:",s),this.toastr.error(s.error?.message||"Reset failed"),this.cancelReset()}})}cancelReset(){this.showResetModal=!1,this.userToReset=null}static \u0275fac=function(e){return new(e||o)(l(v),l(b),l(j),l(X))};static \u0275cmp=f({type:o,selectors:[["app-manage-users"]],decls:22,vars:4,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search users...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","manage-users",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-2"],[3,"click","ngClass"],[1,"fas",3,"ngClass"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-key"],["colspan","7",1,"text-center","text-muted"],[1,"modal-backdrop"],[1,"modal-content"],[1,"modal-title"],[1,"modal-actions","mt-3","d-flex","justify-content-center","gap-3"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),r(2,"Admin Dashboard"),n(),t(3,"a",1),r(4,"Home"),n(),t(5,"a",2),r(6,"Manage Users"),n(),t(7,"a",3),r(8,"Audit Logs"),n(),t(9,"a",4),m("click",function(){return s.logout()}),r(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),w("ngModelChange",function(p){return P(s.searchTerm,p)||(s.searchTerm=p),p}),m("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),r(18,"Manage Users"),n(),h(19,se,3,0,"div",12)(20,le,21,2,"div",13),n()()(),h(21,me,14,1,"div",14)),e&2&&(a(14),k("ngModel",s.searchTerm),a(5),u("ngIf",s.isLoading),a(),u("ngIf",!s.isLoading),a(),u("ngIf",s.showResetModal))},dependencies:[_,x,F,T,D,N,A,K,R,Q,I],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0006;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:10px;width:90%;max-width:400px;text-align:center;box-shadow:0 5px 20px #0000004d}"]})};var te={production:!0,apiUrl:"https://13.58.121.1/api"};function pe(o,i){if(o&1&&(t(0,"tr")(1,"td"),r(2),n(),t(3,"td"),r(4),n(),t(5,"td"),r(6),n(),t(7,"td"),r(8),n(),t(9,"td"),r(10),n(),t(11,"td"),r(12),E(13,"date"),n(),t(14,"td",18),r(15),n()()),o&2){let e=i.$implicit;a(2),c(e.action),a(2),c(e.user_id||"N/A"),a(2),c(e.user_username||"N/A"),a(2),c(e.user_email||"N/A"),a(2),c(e.user_role||"N/A"),a(2),c(U(13,7,e.created_at,"medium")),a(3),c(e.details)}}var V=class o{constructor(i,e,s){this.authService=i;this.router=e;this.http=s}searchTerm="";auditLogs=[];filteredLogs=[];ngOnInit(){this.fetchAuditLogs()}fetchAuditLogs(){this.http.get(`${te.apiUrl}/audit-logs`).subscribe(i=>{this.auditLogs=i,this.filteredLogs=[...i]},i=>{console.error("\u274C Failed to load audit logs",i)})}onSearch(){let i=this.searchTerm.toLowerCase();this.filteredLogs=this.auditLogs.filter(e=>e.action.toLowerCase().includes(i)||e.details.toLowerCase().includes(i)||e.user_email&&e.user_email.toLowerCase().includes(i)||e.user_role&&e.user_role.toLowerCase().includes(i)||e.user_username&&e.user_username.toLowerCase().includes(i)||String(e.user_id).includes(i))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||o)(l(v),l(b),l(L))};static \u0275cmp=f({type:o,selectors:[["app-audit"]],decls:39,vars:2,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search logs...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","audit-logs",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[2,"white-space","nowrap"],[2,"min-width","200px"],[4,"ngFor","ngForOf"],[2,"white-space","normal","word-break","break-word"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),r(2,"Admin Dashboard"),n(),t(3,"a",1),r(4,"Home"),n(),t(5,"a",2),r(6,"Manage Users"),n(),t(7,"a",3),r(8,"Audit Logs"),n(),t(9,"a",4),m("click",function(){return s.logout()}),r(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),w("ngModelChange",function(p){return P(s.searchTerm,p)||(s.searchTerm=p),p}),m("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),r(18,"Audit Logs"),n(),t(19,"div",12)(20,"table",13)(21,"thead",14)(22,"tr")(23,"th",15),r(24,"Action"),n(),t(25,"th",15),r(26,"User ID"),n(),t(27,"th",15),r(28,"User Name"),n(),t(29,"th",15),r(30,"Email"),n(),t(31,"th",15),r(32,"Role"),n(),t(33,"th",15),r(34,"Date"),n(),t(35,"th",16),r(36,"Details"),n()()(),t(37,"tbody"),h(38,pe,16,10,"tr",17),n()()()()()()),e&2&&(a(14),k("ngModel",s.searchTerm),a(24),u("ngForOf",s.filteredLogs))},dependencies:[_,x,F,T,D,N,A,R,I],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var Le=[{path:"",component:O,canActivate:[y],data:{role:"admin"}},{path:"dashboard",component:O,canActivate:[y],data:{role:"admin"}},{path:"manage-users",component:$,canActivate:[y],data:{role:"admin"}},{path:"audit",component:V,canActivate:[y],data:{role:"admin"}}];export{Le as ADMIN_ROUTES};
