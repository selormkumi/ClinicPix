import{a as X}from"./chunk-K7RTRRKJ.js";import{a as O,c as Q}from"./chunk-GHHRRHJY.js";import{a as y}from"./chunk-AF3QZ4WF.js";import{b as D,f as F,i as V,t as j}from"./chunk-UKKNGMUV.js";import{b as N,j as v,k as C,n as M,o as S}from"./chunk-7LQAGGHQ.js";import"./chunk-RWGEFZSS.js";import{Bb as c,Db as g,Kb as i,Lb as d,Mb as W,Ob as E,Pb as U,Qb as I,Ta as a,Tb as J,Ua as p,X as q,a as w,aa as G,b as P,db as x,f as Y,ha as f,ia as h,ib as b,oc as K,pb as m,pc as A,qc as R,sc as L,ub as t,vb as n,wb as _,zb as T}from"./chunk-47VD7EEE.js";var k=class r{constructor(o,e){this.authService=o;this.router=e}currentUserName="User";ngOnInit(){let o=localStorage.getItem("user");if(o)try{let e=JSON.parse(o);this.currentUserName=e.userName?.trim()||e.username?.trim()||e.name?.trim()||"Unknown",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||r)(p(y),p(v))};static \u0275cmp=x({type:r,selectors:[["app-dashboard"]],decls:28,vars:0,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),c("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"h3"),i(14,"Welcome, Admin"),n(),t(15,"p"),i(16,"Monitor and manage the platform efficiently."),n()(),t(17,"div",7)(18,"div",8)(19,"h5"),i(20,"Dashboard Overview"),n(),t(21,"p"),i(22,"Welcome to the Admin Dashboard. Here you can:"),n(),t(23,"ul")(24,"li"),i(25,"Manage users efficiently."),n(),t(26,"li"),i(27,"Review audit logs for activity tracking."),n()()()()())},dependencies:[M,C],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var ne=Y(X());var $=class r{constructor(o){this.http=o}baseUrl=`${S.apiUrl}/users`;getAllUsers(){return this.http.get(`${this.baseUrl}/all`)}updateUser(o,e){return this.http.put(`${this.baseUrl}/${o}`,e)}activateUser(o){return this.http.patch(`${this.baseUrl}/activate/${o}`,{})}deactivateUser(o){return this.http.patch(`${this.baseUrl}/deactivate/${o}`,{})}adminResetPassword(o,e){return this.http.post(`${S.apiUrl}/auth/admin-reset-password`,{targetEmail:o},e)}getAuditLogs(){return this.http.get(`${S.apiUrl}/audit-logs`)}static \u0275fac=function(e){return new(e||r)(G(N))};static \u0275prov=q({token:r,factory:r.\u0275fac,providedIn:"root"})};var le=(r,o)=>({"text-success":r,"text-danger":o});function de(r,o){r&1&&(t(0,"div",15),_(1,"i",16),i(2," Loading users... "),n())}function ce(r,o){if(r&1){let e=T();t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),n(),t(5,"td"),i(6),n(),t(7,"td"),i(8),n(),t(9,"td"),i(10),n(),t(11,"td")(12,"span",23),i(13),n()(),t(14,"td",20)(15,"div",24)(16,"button",25),c("click",function(){let l=f(e).$implicit,u=g(2);return h(u.toggleUserStatus(l))}),_(17,"i",26),i(18),n(),t(19,"button",27),c("click",function(){let l=f(e).$implicit,u=g(2);return h(u.resetPassword(l))}),_(20,"i",28),i(21," Reset Password "),n()()()()}if(r&2){let e=o.$implicit;a(2),d(e.id),a(2),d(e.username),a(2),d(e.email),a(2),d(e.role),a(2),d(e.date_created_local),a(2),m("ngClass",J(10,le,e.is_active,!e.is_active)),a(),W(" ",e.is_active?"Active":"Inactive"," "),a(3),m("ngClass",e.is_active?"btn btn-danger btn-sm":"btn btn-success btn-sm"),a(),m("ngClass",e.is_active?"fa-user-times":"fa-user-check"),a(),W(" ",e.is_active?"Deactivate":"Activate"," ")}}function me(r,o){r&1&&(t(0,"tr")(1,"td",29),i(2,"No users found."),n()())}function pe(r,o){if(r&1&&(t(0,"div",17)(1,"table",18)(2,"thead",19)(3,"tr")(4,"th"),i(5,"User ID"),n(),t(6,"th"),i(7,"User Name"),n(),t(8,"th"),i(9,"Email"),n(),t(10,"th"),i(11,"Role"),n(),t(12,"th"),i(13,"Date Created"),n(),t(14,"th"),i(15,"Status"),n(),t(16,"th",20),i(17,"Actions"),n()()(),t(18,"tbody"),b(19,ce,22,13,"tr",21)(20,me,3,0,"tr",22),n()()()),r&2){let e=g();a(19),m("ngForOf",e.filteredUsers),a(),m("ngIf",e.filteredUsers.length===0)}}function ue(r,o){if(r&1){let e=T();t(0,"div",30)(1,"div",31)(2,"h4",32),i(3,"Reset Password"),n(),t(4,"p",33),i(5," Please confirm you want to send a password reset link to:"),_(6,"br"),t(7,"strong"),i(8),n()(),t(9,"div",34)(10,"button",35),c("click",function(){f(e);let l=g();return h(l.cancelReset())}),i(11,"Cancel"),n(),t(12,"button",36),c("click",function(){f(e);let l=g();return h(l.confirmResetPassword())}),i(13,"Confirm"),n()()()()}if(r&2){let e=g();a(8),d(e.userToReset==null?null:e.userToReset.email)}}function ge(r,o){if(r&1){let e=T();t(0,"div",30)(1,"div",31)(2,"h4",32),i(3,"Confirm Action"),n(),t(4,"p",33),i(5," Are you sure you want to "),t(6,"strong"),i(7),n(),i(8," the user "),t(9,"strong"),i(10),n(),i(11,"? "),n(),t(12,"div",34)(13,"button",35),c("click",function(){f(e);let l=g();return h(l.cancelToggle())}),i(14,"Cancel"),n(),t(15,"button",36),c("click",function(){f(e);let l=g();return h(l.confirmToggleStatus())}),i(16,"Confirm"),n()()()()}if(r&2){let e=g();a(7),d(e.userToToggle!=null&&e.userToToggle.is_active?"deactivate":"activate"),a(3),d(e.userToToggle==null?null:e.userToToggle.email)}}var B=class r{constructor(o,e,s,l){this.authService=o;this.router=e;this.adminService=s;this.snackBar=l}searchTerm="";users=[];filteredUsers=[];isLoading=!1;showResetModal=!1;showStatusModal=!1;userToReset=null;userToToggle=null;ngOnInit(){this.fetchUsers()}fetchUsers(){this.isLoading=!0,this.adminService.getAllUsers().subscribe(o=>{this.users=o.map(e=>P(w({},e),{date_created_local:ne.utc(e.date_created).local().format("MMM D YYYY, hh:mm:ss A")})),this.filteredUsers=[...this.users],this.isLoading=!1},o=>{console.error("\u274C ERROR: Failed to fetch users",o),this.isLoading=!1})}onSearch(){let o=this.searchTerm.toLowerCase();this.filteredUsers=this.users.filter(e=>e.username.toLowerCase().includes(o)||e.email.toLowerCase().includes(o))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"])}toggleUserStatus(o){this.userToToggle=o,this.showStatusModal=!0}confirmToggleStatus(){if(!this.userToToggle)return;(this.userToToggle.is_active?this.adminService.deactivateUser:this.adminService.activateUser).call(this.adminService,this.userToToggle.id).subscribe({next:()=>{this.userToToggle.is_active=!this.userToToggle.is_active,this.snackBar.open(`\u2705 User ${this.userToToggle.is_active?"activated":"deactivated"} successfully`),this.cancelToggle()},error:()=>{this.snackBar.open("\u274C Action failed"),this.cancelToggle()}})}cancelToggle(){this.showStatusModal=!1,this.userToToggle=null}resetPassword(o){this.userToReset=o,this.showResetModal=!0}confirmResetPassword(){if(!this.userToReset)return;let o=localStorage.getItem("token");if(!o){this.snackBar.open("Admin token missing. Please log in again.");return}let e={headers:{Authorization:`Bearer ${o}`}};this.adminService.adminResetPassword(this.userToReset.email,e).subscribe({next:()=>{this.snackBar.open(`\u2705 Password reset link sent to ${this.userToReset.email}`),this.cancelReset()},error:s=>{console.error("\u274C Admin reset failed:",s),this.snackBar.open(s.error?.message||"\u274C Reset failed"),this.cancelReset()}})}cancelReset(){this.showResetModal=!1,this.userToReset=null}static \u0275fac=function(e){return new(e||r)(p(y),p(v),p($),p(Q))};static \u0275cmp=x({type:r,selectors:[["app-manage-users"]],decls:23,vars:5,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search users...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","manage-users",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ngClass"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-2"],[3,"click","ngClass"],[1,"fas",3,"ngClass"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-key"],["colspan","7",1,"text-center","text-muted"],[1,"modal-overlay"],[1,"modal-box"],[1,"modal-title"],[1,"modal-message"],[1,"modal-buttons"],[1,"modal-btn","cancel",3,"click"],[1,"modal-btn","delete",3,"click"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),c("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),I("ngModelChange",function(u){return U(s.searchTerm,u)||(s.searchTerm=u),u}),c("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),i(18,"Manage Users"),n(),b(19,de,3,0,"div",12)(20,pe,21,2,"div",13),n()()(),b(21,ue,14,1,"div",14)(22,ge,17,2,"div",14)),e&2&&(a(14),E("ngModel",s.searchTerm),a(5),m("ngIf",s.isLoading),a(),m("ngIf",!s.isLoading),a(),m("ngIf",s.showResetModal),a(),m("ngIf",s.showStatusModal))},dependencies:[M,C,j,D,F,V,L,K,A,R],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#0006;display:flex;justify-content:center;align-items:center;z-index:1050}.modal-box[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:420px;box-shadow:0 5px 20px #0003;text-align:left}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.modal-message[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:1.5rem;color:#333}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.modal-btn[_ngcontent-%COMP%]{padding:.5rem 1.25rem;font-size:.9rem;border:none;border-radius:6px;cursor:pointer}.modal-btn.cancel[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.modal-btn.delete[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}"]})};var ie=Y(X());function fe(r,o){r&1&&(t(0,"div",19),_(1,"i",20),i(2," Loading logs... "),n())}function he(r,o){if(r&1&&(t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),n(),t(5,"td"),i(6),n(),t(7,"td"),i(8),n(),t(9,"td"),i(10),n(),t(11,"td"),i(12),n(),t(13,"td",21),i(14),n()()),r&2){let e=o.$implicit;a(2),d(e.action),a(2),d(e.user_id||"N/A"),a(2),d(e.user_username||"N/A"),a(2),d(e.user_email||"N/A"),a(2),d(e.user_role||"N/A"),a(2),d(e.created_at_local),a(2),d(e.details)}}var H=class r{constructor(o,e,s){this.authService=o;this.router=e;this.http=s}searchTerm="";auditLogs=[];filteredLogs=[];isLoading=!1;ngOnInit(){this.fetchAuditLogs()}fetchAuditLogs(){this.isLoading=!0,this.http.get(`${S.apiUrl}/audit-logs`).subscribe({next:o=>{this.auditLogs=o.map(e=>P(w({},e),{created_at_local:ie.utc(e.created_at).local().format("MMM D YYYY, hh:mm:ss A")})),this.filteredLogs=[...this.auditLogs],this.isLoading=!1},error:o=>{console.error("\u274C Failed to load audit logs",o),this.isLoading=!1}})}onSearch(){let o=this.searchTerm.toLowerCase();this.filteredLogs=this.auditLogs.filter(e=>e.action.toLowerCase().includes(o)||e.details.toLowerCase().includes(o)||e.user_email&&e.user_email.toLowerCase().includes(o)||e.user_role&&e.user_role.toLowerCase().includes(o)||e.user_username&&e.user_username.toLowerCase().includes(o)||String(e.user_id).includes(o))}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||r)(p(y),p(v),p(N))};static \u0275cmp=x({type:r,selectors:[["app-audit"]],decls:40,vars:3,consts:[[1,"sidebar"],["routerLink","/admin/dashboard"],["routerLink","/admin/manage-users"],["routerLink","/admin/audit"],["href","#",3,"click"],[1,"main-content"],[1,"row","mb-3"],[1,"col-md-6"],["type","text","placeholder","Search logs...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","audit-logs",1,"card","shadow-sm"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","align-middle"],[1,"table-primary"],[2,"white-space","nowrap"],[2,"min-width","200px"],[4,"ngFor","ngForOf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[2,"white-space","normal","word-break","break-word"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"h2"),i(2,"Admin Dashboard"),n(),t(3,"a",1),i(4,"Home"),n(),t(5,"a",2),i(6,"Manage Users"),n(),t(7,"a",3),i(8,"Audit Logs"),n(),t(9,"a",4),c("click",function(){return s.logout()}),i(10,"Logout"),n()(),t(11,"div",5)(12,"div",6)(13,"div",7)(14,"input",8),I("ngModelChange",function(u){return U(s.searchTerm,u)||(s.searchTerm=u),u}),c("input",function(){return s.onSearch()}),n()()(),t(15,"div",9)(16,"div",10)(17,"h5",11),i(18,"Audit Logs"),n(),b(19,fe,3,0,"div",12),t(20,"div",13)(21,"table",14)(22,"thead",15)(23,"tr")(24,"th",16),i(25,"Action"),n(),t(26,"th",16),i(27,"User ID"),n(),t(28,"th",16),i(29,"User Name"),n(),t(30,"th",16),i(31,"Email"),n(),t(32,"th",16),i(33,"Role"),n(),t(34,"th",16),i(35,"Timestamp"),n(),t(36,"th",17),i(37,"Details"),n()()(),t(38,"tbody"),b(39,he,15,7,"tr",18),n()()()()()()),e&2&&(a(14),E("ngModel",s.searchTerm),a(5),m("ngIf",s.isLoading),a(20),m("ngForOf",s.filteredLogs))},dependencies:[M,C,j,D,F,V,L,A,R],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};var Ve=[{path:"",component:k,canActivate:[O],data:{role:"admin"}},{path:"dashboard",component:k,canActivate:[O],data:{role:"admin"}},{path:"manage-users",component:B,canActivate:[O],data:{role:"admin"}},{path:"audit",component:H,canActivate:[O],data:{role:"admin"}}];export{Ve as ADMIN_ROUTES};
