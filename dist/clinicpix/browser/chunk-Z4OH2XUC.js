import{a as R,b as Y,c as Q,d as xe,e as be,f as q,g as G,h as Ce,i as ve,j as Pe,k as Me}from"./chunk-YOZLQWE5.js";import{a as V}from"./chunk-ZTEPIX7G.js";import{b as w}from"./chunk-D6KYB4US.js";import{b as L,f as D,g as ge,h as ue,i as A,j as fe,k as _e,n as z,o as W,p as B,q as he,t as T}from"./chunk-WFSOM37F.js";import{j as O,k as y,m as I}from"./chunk-YITIAFLR.js";import"./chunk-OTQCBJ2V.js";import{Ab as de,Bb as se,Cb as o,Db as P,Eb as f,Fb as J,Gb as x,Hb as b,Ib as C,Kb as ce,Oa as d,Ob as pe,Pa as h,Za as S,a as k,b as H,cb as _,da as p,ea as m,ec as me,fc as F,gc as U,ic as N,jb as g,nb as n,ob as t,pb as v,sb as M,ub as u,vb as c,yb as ae,zb as le}from"./chunk-Z3TPZZXO.js";var j=class l{constructor(i,e){this.authService=i;this.router=e}currentUserName="User";ngOnInit(){let i=localStorage.getItem("user");if(i)try{let e=JSON.parse(i);this.currentUserName=e.userName?.trim()||e.username?.trim()||"User",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||l)(h(w),h(O))};static \u0275cmp=S({type:l,selectors:[["app-dashboard"]],decls:34,vars:1,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Provider Dashboard"),t(),n(3,"a",1),o(4,"Home"),t(),n(5,"a",2),o(6,"Patients"),t(),n(7,"a",3),o(8,"Uploaded Images"),t(),n(9,"a",4),o(10,"Shared Images"),t(),n(11,"a",5),o(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),o(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"h3"),o(18),t(),n(19,"p"),o(20,"Manage your patients and medical image sharing efficiently."),t()(),n(21,"div",9)(22,"div",10)(23,"h5"),o(24,"Dashboard Overview"),t(),n(25,"p"),o(26,"Welcome to your healthcare provider dashboard. Here you can:"),t(),n(27,"ul")(28,"li"),o(29,"View and manage your patients' uploaded images."),t(),n(30,"li"),o(31,"Share images securely with your patients."),t(),n(32,"li"),o(33,"Update your profile and contact information."),t()()()()()),e&2&&(d(18),f("Welcome, ",a.currentUserName,""))},dependencies:[I,y],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};function Oe(l,i){if(l&1&&(n(0,"option",25),o(1),t()),l&2){let e=i.$implicit;g("value",e.email),d(),J(" ",e.username," (",e.email,") ")}}function ye(l,i){if(l&1){let e=M();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td",26)(8,"div",27)(9,"button",28),u("click",function(){let r=p(e).$implicit,s=c();return m(s.removePatient(r.id))}),v(10,"i",29),o(11," Remove "),t()()()()}if(l&2){let e=i.$implicit;d(2),P(e.username),d(2),P(e.email),d(2),P(e.phone)}}function Ie(l,i){l&1&&(n(0,"tr")(1,"td",30),o(2,"No patients found."),t()())}var ee=class l{constructor(i,e,a){this.authService=i;this.router=e;this.s3FileService=a}searchTerm="";patients=[];filteredPatients=[];newPatientEmail="";selectedPatientEmail="";availablePatientEmails=[];ngOnInit(){localStorage.getItem("user")?(this.loadPatients(),this.fetchAvailablePatientEmails()):console.error("\u274C No current user found in localStorage.")}onSearch(){this.filteredPatients=this.patients.filter(i=>i.name?.toLowerCase().includes(this.searchTerm.toLowerCase())||i.email?.toLowerCase().includes(this.searchTerm.toLowerCase())||i.phone?.includes(this.searchTerm))}assignPatient(){if(!this.selectedPatientEmail){alert("Please select a patient email.");return}let e=JSON.parse(localStorage.getItem("user")||"{}").userId;if(!e){alert("No valid provider ID found.");return}this.s3FileService.assignPatient(e,this.selectedPatientEmail).subscribe(()=>{alert("\u2705 Patient assigned!"),this.selectedPatientEmail="",this.loadPatients(),this.fetchAvailablePatientEmails()},a=>{console.error("\u274C ERROR assigning patient",a),alert(a?.error?.error||"Failed to assign patient.")})}loadPatients(){let e=JSON.parse(localStorage.getItem("user")||"{}").userId;if(!e){console.error("\u274C No valid provider ID found.");return}this.s3FileService.getPatientsByProvider(e).subscribe(a=>{this.patients=a.patients||[],this.filteredPatients=this.patients},a=>{console.error("\u274C ERROR loading patients",a)})}fetchAvailablePatientEmails(){let e=JSON.parse(localStorage.getItem("user")||"{}").userId;e&&this.s3FileService.getAllPatientEmails(e).subscribe(a=>{this.availablePatientEmails=a.patients||[]},a=>{console.error("\u274C ERROR fetching emails",a)})}removePatient(i){let a=JSON.parse(localStorage.getItem("user")||"{}").userId;confirm("Are you sure you want to remove this patient?")&&this.s3FileService.unassignPatient(a,i).subscribe(()=>{alert("\u2705 Patient removed."),this.loadPatients(),this.fetchAvailablePatientEmails()},r=>{console.error("\u274C ERROR unassigning patient",r),alert("Failed to remove patient.")})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(h(w),h(O),h(R))};static \u0275cmp=S({type:l,selectors:[["app-patients"]],decls:44,vars:5,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"mb-3","d-flex","justify-content-between","align-items-center"],["type","text","placeholder","Search Patients...",1,"form-control","w-50",3,"ngModelChange","input","ngModel"],["id","patients",1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],[1,"add-patient-form","mb-4","d-flex","flex-wrap","gap-2","align-items-center"],[1,"form-select","form-select-sm","custom-select-width",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-striped","align-middle","table-bordered"],[1,"table-primary"],[1,"text-center",2,"width","160px"],[2,"font-size","1rem"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],[1,"text-center"],[1,"d-flex","justify-content-center","gap-2","flex-wrap"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-trash","me-1"],["colspan","4",1,"text-center","text-muted"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Provider Dashboard"),t(),n(3,"a",1),o(4,"Home"),t(),n(5,"a",2),o(6,"Patients"),t(),n(7,"a",3),o(8,"Uploaded Images"),t(),n(9,"a",4),o(10,"Shared Images"),t(),n(11,"a",5),o(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),o(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"input",9),C("ngModelChange",function(s){return b(a.searchTerm,s)||(a.searchTerm=s),s}),u("input",function(){return a.onSearch()}),t()(),n(18,"div",10)(19,"div",11)(20,"h5",12),o(21,"Patients"),t(),n(22,"div",13)(23,"select",14),C("ngModelChange",function(s){return b(a.selectedPatientEmail,s)||(a.selectedPatientEmail=s),s}),n(24,"option",15),o(25,"Select a patient"),t(),_(26,Oe,2,3,"option",16),t(),n(27,"button",17),u("click",function(){return a.assignPatient()}),o(28,"+ Add Patient"),t()(),n(29,"div",18)(30,"table",19)(31,"thead",20)(32,"tr")(33,"th"),o(34,"Username"),t(),n(35,"th"),o(36,"Email"),t(),n(37,"th"),o(38,"Phone"),t(),n(39,"th",21),o(40,"Actions"),t()()(),n(41,"tbody",22),_(42,ye,12,3,"tr",23)(43,Ie,3,0,"tr",24),t()()()()()()),e&2&&(d(17),x("ngModel",a.searchTerm),d(6),x("ngModel",a.selectedPatientEmail),d(3),g("ngForOf",a.availablePatientEmails),d(16),g("ngForOf",a.filteredPatients),d(),g("ngIf",a.filteredPatients.length===0))},dependencies:[I,y,T,W,B,L,z,D,A,N,F,U],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}.custom-select-width[_ngcontent-%COMP%]{width:500px!important}"]})};var we=["fileInput"],Ee=l=>({dragging:l});function ke(l,i){l&1&&(n(0,"p",31)(1,"strong"),o(2,"Drag & drop an image file here"),t()())}function Fe(l,i){if(l&1&&(n(0,"p",31)(1,"strong"),o(2),t()()),l&2){let e=c();d(2),f("Selected: ",e.pendingFile.name,"")}}function Ue(l,i){if(l&1&&(n(0,"span"),o(1),t()),l&2){let e=c().$implicit;d(),f("(",e.uploaderEmail,")")}}function Ne(l,i){if(l&1&&(n(0,"span",42),o(1),t()),l&2){let e=i.$implicit;d(),P(e)}}function Te(l,i){if(l&1&&(n(0,"span"),_(1,Ne,2,1,"span",41),t()),l&2){let e=c().$implicit;d(),g("ngForOf",e.tags)}}function Re(l,i){l&1&&o(0,"No tags")}function Ve(l,i){if(l&1&&(n(0,"option",50),o(1),t()),l&2){let e=i.$implicit;g("value",e.email),d(),J(" ",e.username," (",e.email,") ")}}function Le(l,i){if(l&1){let e=M();n(0,"div",43)(1,"select",44),C("ngModelChange",function(r){p(e);let s=c(2);return b(s.selectedPatientEmail,r)||(s.selectedPatientEmail=r),m(r)}),n(2,"option",45),o(3,"Select patient email"),t(),_(4,Ve,2,3,"option",46),t(),n(5,"button",47),u("click",function(){p(e);let r=c().$implicit,s=c();return m(s.shareImageToPatient(r))}),v(6,"i",48),o(7," Share "),t(),n(8,"button",49),u("click",function(){p(e);let r=c().$implicit;return m(r.showDropdown=!1)}),o(9," Cancel "),t()()}if(l&2){let e=c(2);d(),x("ngModel",e.selectedPatientEmail),d(3),g("ngForOf",e.assignedPatients)}}function De(l,i){if(l&1){let e=M();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),_(5,Ue,2,1,"span",29),t(),n(6,"td"),o(7),t(),n(8,"td"),_(9,Te,2,1,"span",32)(10,Re,1,0,"ng-template",null,1,pe),t(),n(12,"td")(13,"div",33)(14,"button",34),u("click",function(){let r=p(e).$implicit,s=c();return m(s.viewImage(r.name))}),v(15,"i",35),o(16," View "),t(),n(17,"button",36),u("click",function(){let r=p(e).$implicit,s=c();return m(s.toggleShareDropdown(r))}),v(18,"i",37),o(19," Share "),t(),n(20,"button",38),u("click",function(){let r=p(e).$implicit,s=c();return m(s.deleteImage(r.name))}),v(21,"i",39),o(22," Delete "),t()(),_(23,Le,10,2,"div",40),t()()}if(l&2){let e=i.$implicit,a=se(11);d(2),P(e.name),d(2),f("",e.uploadedBy," "),d(),g("ngIf",e.uploaderEmail),d(2),P(e.uploadedOn),d(2),g("ngIf",e.tags.length>0)("ngIfElse",a),d(14),g("ngIf",e.showDropdown)}}function Ae(l,i){l&1&&(n(0,"tr")(1,"td",51),o(2,"No uploaded images found."),t()())}function ze(l,i){if(l&1){let e=M();n(0,"app-image-modal",52),u("closeModal",function(){p(e);let r=c();return m(r.closeModal())})("saveChanges",function(r){p(e);let s=c();return m(s.saveChanges(r))}),t()}if(l&2){let e=c();g("image",e.selectedImage)}}var te=class l{constructor(i,e,a){this.authService=i;this.router=e;this.s3Service=a}currentUserId=0;currentUserName=null;selectedImage=null;isEditing=!1;isLoading=!1;uploadedImages=[];newFileName="";newFileTags="";pendingFile=null;isDragging=!1;assignedPatients=[];selectedPatientEmail="";fileInput;ngOnInit(){let i=localStorage.getItem("user");if(i){let e=JSON.parse(i);this.currentUserId=Number(e.userId)||0,this.currentUserName=e.username||null}this.fetchUploadedImages(),this.loadAssignedPatients()}fetchUploadedImages(){this.isLoading=!0,this.s3Service.getUploadedFiles(this.currentUserId).subscribe(i=>{this.uploadedImages=i.files.map(e=>({name:e.fileName||"Unknown File",uploadedBy:e.uploadedBy||"Unknown",uploaderEmail:e.uploaderEmail||"",uploadedOn:e.uploadedOn?new Date(e.uploadedOn).toLocaleString("en-US",{timeZone:"America/New_York",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",tags:Array.isArray(e.tags)?e.tags:[],showDropdown:!1})),this.isLoading=!1},i=>{console.error("\u274C ERROR: Failed to fetch uploaded files",i),this.isLoading=!1})}loadAssignedPatients(){this.s3Service.getPatientsByProvider(this.currentUserId).subscribe(i=>{this.assignedPatients=i.patients||[]},i=>{console.error("\u274C Failed to load assigned patients:",i)})}logout(){this.authService.logout(),this.router.navigate(["/login"])}viewImage(i){this.s3Service.getFileUrl(i,this.currentUserId).subscribe(e=>{this.selectedImage={name:i,viewUrl:e.viewUrl}},e=>{console.error("\u274C ERROR: Failed to generate view URL",e),alert("Unable to view image. Try again.")})}toggleShareDropdown(i){this.uploadedImages.forEach(e=>{e!==i&&(e.showDropdown=!1)}),i.showDropdown=!i.showDropdown}shareImageToPatient(i){let e=this.assignedPatients.find(r=>r.email===this.selectedPatientEmail);if(!e){alert("Please select a valid patient.");return}this.s3Service.shareFile(i.name,this.currentUserId,e.id,86400).subscribe(()=>{alert("\u2705 Image shared successfully!"),i.showDropdown=!1,this.selectedPatientEmail=""},r=>{console.error("\u274C Failed to share image",r),alert("\u274C Failed to share image.")})}shareImage(i,e){if(!e||e===0){alert("Invalid user ID for sharing.");return}this.s3Service.shareFile(i,this.currentUserId,e,86400).subscribe(r=>{alert(`\u2705 Image shared successfully with User ID: ${e}`),console.log("Shared Link:",r.viewUrl)},r=>{console.error("\u274C ERROR: Failed to share image",r),alert("Failed to share image. Please try again.")})}deleteImage(i){confirm(`Are you sure you want to delete ${i}?`)&&this.s3Service.deleteFile(i,this.currentUserId).subscribe(()=>{alert("\u2705 File deleted successfully!"),this.fetchUploadedImages()},e=>{console.error("\u274C ERROR: Failed to delete file",e),alert("Failed to delete file. Please try again.")})}triggerFileInput(){this.fileInput.nativeElement.click()}uploadImage(i){let e=i.target;e.files&&e.files.length>0&&(this.pendingFile=e.files[0],this.newFileName=this.pendingFile.name)}confirmUpload(){if(!this.pendingFile){alert("Please select a file to upload.");return}if(!this.currentUserId||this.currentUserId===0){alert("You must be logged in to upload files.");return}let i=this.pendingFile.name,e=this.pendingFile.type,a=this.newFileTags?this.newFileTags.split(",").map(r=>r.trim()):[];this.s3Service.uploadFile(i,e,this.currentUserId,a).subscribe(r=>{r.uploadUrl&&fetch(r.uploadUrl,{method:"PUT",body:this.pendingFile,headers:{"Content-Type":e}}).then(()=>{alert("\u2705 File uploaded successfully!"),this.fetchUploadedImages(),this.resetUploadForm()}).catch(s=>{console.error("\u274C Upload error:",s),alert("Upload failed. Please try again.")})},r=>{console.error("\u274C ERROR: Failed to upload file",r),alert("Failed to upload file. Please try again.")})}handleDragOver(i){i.preventDefault(),this.isDragging=!0}handleDragLeave(){this.isDragging=!1}handleDrop(i){i.preventDefault(),this.isDragging=!1,i.dataTransfer&&i.dataTransfer.files.length>0&&(this.pendingFile=i.dataTransfer.files[0],this.newFileName=this.pendingFile.name)}resetUploadForm(){this.pendingFile=null,this.newFileName="",this.newFileTags="",this.fileInput&&this.fileInput.nativeElement&&(this.fileInput.nativeElement.value=""),this.isDragging=!1}closeModal(){this.selectedImage=null,this.isEditing=!1}saveChanges(i){if(this.selectedImage){let e=this.uploadedImages.findIndex(a=>a.name===this.selectedImage.name);e!==-1&&(this.uploadedImages[e]=k(k({},this.selectedImage),i))}this.selectedImage=null,this.isEditing=!1}static \u0275fac=function(e){return new(e||l)(h(w),h(O),h(R))};static \u0275cmp=S({type:l,selectors:[["app-uploaded-images"]],viewQuery:function(e,a){if(e&1&&ae(we,5),e&2){let r;le(r=de())&&(a.fileInput=r.first)}},decls:56,vars:11,consts:[["fileInput",""],["noTags",""],[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"uploaded-images-section"],[1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],[1,"drop-zone","border","p-4","mb-4","rounded","text-center",3,"dragover","dragleave","drop","ngClass"],[1,"fas","fa-cloud-upload-alt","fa-2x","text-primary","mb-2"],["class","mb-2",4,"ngIf"],[1,"btn","btn-success","btn-sm","mt-2",3,"click"],["type","file","accept",".jpeg,.jpg,.png,.pdf",2,"display","none",3,"change"],[1,"upload-controls","d-flex","align-items-center","gap-3","mb-4","flex-wrap"],[1,"me-2"],["type","text","placeholder","Enter tag(s)",1,"form-control","form-control-sm","w-auto",2,"min-width","200px",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"fas","fa-upload"],[1,"table-responsive"],[1,"table","table-striped","align-middle","table-bordered"],[1,"table-primary"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"image","closeModal","saveChanges",4,"ngIf"],[1,"mb-2"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-warning","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-share-alt"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-trash"],["class","d-flex flex-wrap gap-2 mt-2",4,"ngIf"],["class","me-1",4,"ngFor","ngForOf"],[1,"me-1"],[1,"d-flex","flex-wrap","gap-2","mt-2"],[1,"form-select","form-select-sm",2,"min-width","200px",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-paper-plane"],[1,"btn","btn-secondary","btn-sm",3,"click"],[3,"value"],["colspan","5",1,"text-center","text-muted"],[3,"closeModal","saveChanges","image"]],template:function(e,a){if(e&1){let r=M();n(0,"div",2)(1,"h2"),o(2,"Provider Dashboard"),t(),n(3,"a",3),o(4,"Home"),t(),n(5,"a",4),o(6,"Patients"),t(),n(7,"a",5),o(8,"Uploaded Images"),t(),n(9,"a",6),o(10,"Shared Images"),t(),n(11,"a",7),o(12,"Profile"),t(),n(13,"a",8),u("click",function(){return p(r),m(a.logout())}),o(14,"Logout"),t()(),n(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h5",13),o(20,"Uploaded Images"),t(),n(21,"div",14),u("dragover",function(E){return p(r),m(a.handleDragOver(E))})("dragleave",function(){return p(r),m(a.handleDragLeave())})("drop",function(E){return p(r),m(a.handleDrop(E))}),v(22,"i",15),_(23,ke,3,0,"p",16)(24,Fe,3,1,"p",16),n(25,"button",17),u("click",function(){return p(r),m(a.triggerFileInput())}),o(26,"Select File"),t(),n(27,"input",18,0),u("change",function(E){return p(r),m(a.uploadImage(E))}),t()(),n(29,"div",19)(30,"span",20)(31,"strong"),o(32,"File Name:"),t(),o(33),t(),n(34,"input",21),C("ngModelChange",function(E){return p(r),b(a.newFileTags,E)||(a.newFileTags=E),m(E)}),t(),n(35,"button",22),u("click",function(){return p(r),m(a.confirmUpload())}),v(36,"i",23),o(37," Upload "),t()(),n(38,"div",24)(39,"table",25)(40,"thead",26)(41,"tr")(42,"th"),o(43,"Image Name"),t(),n(44,"th"),o(45,"Uploaded By"),t(),n(46,"th"),o(47,"Uploaded On"),t(),n(48,"th"),o(49,"Tag(s)"),t(),n(50,"th",27),o(51,"Actions"),t()()(),n(52,"tbody"),_(53,De,24,7,"tr",28)(54,Ae,3,0,"tr",29),t()()(),_(55,ze,1,1,"app-image-modal",30),t()()()()}e&2&&(d(21),g("ngClass",ce(9,Ee,a.isDragging)),d(2),g("ngIf",!a.pendingFile),d(),g("ngIf",a.pendingFile),d(9),f(" ",(a.pendingFile==null?null:a.pendingFile.name)||"No file selected",""),d(),x("ngModel",a.newFileTags),d(),g("disabled",!a.pendingFile),d(18),g("ngForOf",a.uploadedImages),d(),g("ngIf",a.uploadedImages.length===0),d(),g("ngIf",a.selectedImage))},dependencies:[N,me,F,U,I,y,T,W,B,L,z,D,A,Y],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}"]})};function We(l,i){if(l&1){let e=M();n(0,"div",10)(1,"div",11)(2,"h2"),o(3),t()(),n(4,"div",12)(5,"p")(6,"strong"),o(7,"Email:"),t(),o(8),t(),n(9,"p")(10,"strong"),o(11,"Date of Birth:"),t(),o(12),t(),n(13,"p")(14,"strong"),o(15,"Country:"),t(),o(16),t(),n(17,"p")(18,"strong"),o(19,"State/City:"),t(),o(20),t(),n(21,"p")(22,"strong"),o(23,"Age:"),t(),o(24),t(),n(25,"p")(26,"strong"),o(27,"Weight:"),t(),o(28),t(),n(29,"p")(30,"strong"),o(31,"Height:"),t(),o(32),t(),n(33,"p")(34,"strong"),o(35,"Address:"),t(),o(36),t(),n(37,"p")(38,"strong"),o(39,"Phone:"),t(),o(40),t(),n(41,"button",13),u("click",function(){p(e);let r=c();return m(r.toggleEdit())}),o(42,"Edit Profile"),t()()()}if(l&2){let e=c();d(3),P(e.provider.name||"No name"),d(5),f(" ",e.provider.email,""),d(4),f(" ",e.provider.dobFormatted||"Not set",""),d(4),f(" ",e.getCountryName(e.provider.country)||"Not set",""),d(4),f(" ",e.provider.state||"Not set",""),d(4),f(" ",e.provider.age?e.provider.age+" Years":"Not set",""),d(4),f(" ",e.provider.weight?e.provider.weight+" lbs":"Not set",""),d(4),f(" ",e.provider.height?e.provider.height+" cm":"Not set",""),d(4),f(" ",e.provider.address||"Not set",""),d(4),f(" ",(e.provider.phone==null?null:e.provider.phone.internationalNumber)||e.provider.phone||"Not set","")}}function Be(l,i){if(l&1&&(n(0,"option",41),o(1),t()),l&2){let e=i.$implicit;g("value",e.isoCode),d(),f(" ",e.name," ")}}function je(l,i){if(l&1&&(n(0,"option",41),o(1),t()),l&2){let e=i.$implicit;g("value",e.name),d(),P(e.name)}}function He(l,i){if(l&1){let e=M();n(0,"div",10)(1,"h3"),o(2,"Edit Profile"),t(),n(3,"form",14),u("ngSubmit",function(){p(e);let r=c();return m(r.saveChanges())}),n(4,"div",15)(5,"label",16),o(6,"Name:"),t(),n(7,"input",17),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.name,r)||(s.provider.name=r),m(r)}),t()(),n(8,"div",15)(9,"label",18),o(10,"Email:"),t(),v(11,"input",19),t(),n(12,"div",15)(13,"label",20),o(14,"Date of Birth:"),t(),n(15,"input",21),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.dob,r)||(s.provider.dob=r),m(r)}),t()(),n(16,"div",15)(17,"label",22),o(18,"Country:"),t(),n(19,"select",23),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.country,r)||(s.provider.country=r),m(r)}),u("change",function(){p(e);let r=c();return m(r.getStates(r.provider.country))}),n(20,"option",24),o(21,"Select Country"),t(),_(22,Be,2,2,"option",25),t()(),n(23,"div",15)(24,"label",26),o(25,"State/City:"),t(),n(26,"select",27),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.state,r)||(s.provider.state=r),m(r)}),u("change",function(){p(e);let r=c();return m(r.getCities(r.provider.state))}),n(27,"option",24),o(28,"Select State/City"),t(),_(29,je,2,2,"option",25),t()(),n(30,"div",15)(31,"label",28),o(32,"Age:"),t(),n(33,"input",29),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.age,r)||(s.provider.age=r),m(r)}),t()(),n(34,"div",15)(35,"label",30),o(36,"Weight (lbs):"),t(),n(37,"input",31),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.weight,r)||(s.provider.weight=r),m(r)}),t()(),n(38,"div",15)(39,"label",32),o(40,"Height (cm):"),t(),n(41,"input",33),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.height,r)||(s.provider.height=r),m(r)}),t()(),n(42,"div",15)(43,"label",34),o(44,"Address:"),t(),n(45,"input",35),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.address,r)||(s.provider.address=r),m(r)}),t()(),n(46,"div",15)(47,"label",36),o(48,"Phone Number:"),t(),n(49,"ngx-intl-tel-input",37),C("ngModelChange",function(r){p(e);let s=c();return b(s.provider.phone,r)||(s.provider.phone=r),m(r)}),t()(),n(50,"div",38)(51,"button",39),o(52,"Save Changes"),t(),o(53,"\xA0 "),n(54,"button",40),u("click",function(){p(e);let r=c();return m(r.toggleEdit())}),o(55,"Cancel"),t()()()()}if(l&2){let e=c();d(7),x("ngModel",e.provider.name),d(4),g("value",e.provider.email),d(4),x("ngModel",e.provider.dob),d(4),x("ngModel",e.provider.country),d(3),g("ngForOf",e.countries),d(4),x("ngModel",e.provider.state),d(3),g("ngForOf",e.states),d(4),x("ngModel",e.provider.age),d(4),x("ngModel",e.provider.weight),d(4),x("ngModel",e.provider.height),d(4),x("ngModel",e.provider.address),d(4),g("cssClass","form-control full-width")("preferredCountries",e.preferredCountries)("enableAutoCountrySelect",!0)("enablePlaceholder",!0)("searchCountryFlag",!0)("searchCountryField",e.searchFields)("selectFirstCountry",!1)("selectedCountryISO",e.provider.country||e.countryISO.UnitedStates)("separateDialCode",!0)("phoneValidation",!0),x("ngModel",e.provider.phone)}}var ne=class l{constructor(i,e,a){this.authService=i;this.router=e;this.s3FileService=a}countries=[];states=[];cities=[];provider={email:"",name:"",dob:"",dobFormatted:"",state:"",country:"",age:0,weight:0,height:"",address:"",phone:null};isEditing=!1;currentUserId=0;searchCountryField=G;countryISO=q;phoneNumberFormat=Ce;searchFields=[G.Iso2,G.Name];preferredCountries=[q.UnitedStates];selectedCountryISO=q.UnitedStates;ngOnInit(){let i=JSON.parse(localStorage.getItem("user")||"{}");this.currentUserId=i.userId,this.currentUserId&&(this.getCountries(),this.fetchProfile())}fetchProfile(){this.s3FileService.getUserById(this.currentUserId).subscribe(i=>{let e=i.country||"",a=i.dob?new Date(i.dob):null,r=i.phone?{number:i.phone,internationalNumber:i.phone,nationalNumber:i.phone,e164Number:i.phone,countryCode:"",dialCode:""}:null;this.provider=H(k(k({},this.provider),i),{country:i.country,dob:a?a.toISOString().split("T")[0]:"",dobFormatted:a?a.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}).replace(",",""):"",phone:r}),e&&(this.getStates(e),this.selectedCountryISO=e)},i=>{console.error("\u274C Failed to fetch profile",i)})}getCountries(){this.countries=Q.getAllCountries()}getCountryName(i){return Q.getCountryByCode(i)?.name||i}getStates(i){this.states=xe.getStatesOfCountry(i),this.cities=[],this.selectedCountryISO=i}getCities(i){let e=this.provider.country;this.cities=be.getCitiesOfState(e,i)}toggleEdit(){this.isEditing=!this.isEditing}saveChanges(){let i=k({},this.provider),e=Q.getAllCountries().find(a=>a.isoCode.toLowerCase()===this.provider.country.toLowerCase()||a.name.toLowerCase()===this.provider.country.toLowerCase());i.country=e?.isoCode||this.provider.country,i.phone=this.provider.phone?.internationalNumber||"",this.s3FileService.updateUserProfile(this.currentUserId,i).subscribe(()=>{console.log("\u2705 Profile saved"),alert("Profile updated!"),this.toggleEdit()},a=>{console.error("\u274C Failed to save profile:",a),alert("Failed to update profile.")})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(h(w),h(O),h(R))};static \u0275cmp=S({type:l,selectors:[["app-provider-profile"]],decls:19,vars:2,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"profile-container"],["class","card",4,"ngIf"],[1,"card"],[1,"profile-header"],[1,"profile-details"],[1,"edit-button",3,"click"],[3,"ngSubmit"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","required","",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email","name","email","disabled","",1,"readonly",3,"value"],["for","dob"],["type","date","id","dob","name","dob",3,"ngModelChange","ngModel"],["for","country"],["id","country","name","country",3,"ngModelChange","change","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","state"],["id","state","name","state",3,"ngModelChange","change","ngModel"],["for","age"],["type","number","id","age","name","age",3,"ngModelChange","ngModel"],["for","weight"],["type","number","id","weight","name","weight",3,"ngModelChange","ngModel"],["for","height"],["type","text","id","height","name","height",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address","name","address",3,"ngModelChange","ngModel"],["for","phone"],["name","phone","id","phone",3,"ngModelChange","cssClass","preferredCountries","enableAutoCountrySelect","enablePlaceholder","searchCountryFlag","searchCountryField","selectFirstCountry","selectedCountryISO","separateDialCode","phoneValidation","ngModel"],[1,"form-buttons"],["type","submit",1,"save-button"],["type","button",1,"cancel-button",3,"click"],[3,"value"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Provider Dashboard"),t(),n(3,"a",1),o(4,"Home"),t(),n(5,"a",2),o(6,"Patients"),t(),n(7,"a",3),o(8,"Uploaded Images"),t(),n(9,"a",4),o(10,"Shared Images"),t(),n(11,"a",5),o(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),o(14,"Logout"),t()(),n(15,"div",7)(16,"div",8),_(17,We,43,10,"div",9)(18,He,56,22,"div",9),t()()),e&2&&(d(17),g("ngIf",!a.isEditing),d(),g("ngIf",a.isEditing))},dependencies:[I,y,T,fe,W,B,L,_e,z,D,ge,he,A,ue,N,F,U,Me,Pe,ve],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.profile-container[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 10px #0000001a;max-width:800px;margin:20px auto}.card[_ngcontent-%COMP%]{background-color:#ecf0f1;padding:20px;border-radius:8px;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:120px;height:120px;margin-bottom:15px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:#34495e;text-align:center}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;line-height:1.6;margin:8px 0;color:#7f8c8d}.edit-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:10px 20px;cursor:pointer;border-radius:4px;font-size:1rem;transition:background-color .3s ease}.edit-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}form[_ngcontent-%COMP%]{display:grid;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:5px;color:#34495e}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:12px;font-size:1rem;border-radius:4px;border:1px solid #bdc3c7;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db}button[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;border:none;cursor:pointer;border-radius:4px;transition:background-color .3s ease}.save-button[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:#27ae60}.cancel-button[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:focus{outline:none}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:20px}@media screen and (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:200px}.main-content[_ngcontent-%COMP%]{margin-left:220px;width:calc(100% - 220px)}.profile-container[_ngcontent-%COMP%]{padding:20px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}.form-group[_ngcontent-%COMP%]   ngx-intl-tel-input[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%}"]})};function Je(l,i){l&1&&(n(0,"div",15),v(1,"i",16),o(2," Loading shared images... "),t())}function Ye(l,i){if(l&1&&(n(0,"span"),o(1),t()),l&2){let e=c().$implicit;d(),f("(",e.sharedWithEmail,")")}}function Qe(l,i){if(l&1){let e=M();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),_(5,Ye,2,1,"span",22),t(),n(6,"td"),o(7),t(),n(8,"td"),o(9),t(),n(10,"td",23)(11,"div",24)(12,"button",25),u("click",function(){let r=p(e).$implicit,s=c(2);return m(s.viewImage(r))}),v(13,"i",26),o(14," View "),t(),n(15,"button",27),u("click",function(){let r=p(e).$implicit,s=c(2);return m(s.revokeAccess(r))}),v(16,"i",28),o(17," Revoke "),t()()()()}if(l&2){let e=i.$implicit;d(2),P(e.name),d(2),f(" ",e.sharedWithName," "),d(),g("ngIf",e.sharedWithEmail),d(2),P(e.sharedOn),d(2),P(e.expiresAt)}}function qe(l,i){l&1&&(n(0,"tr")(1,"td",29),o(2,"No shared images found."),t()())}function Ge(l,i){if(l&1&&(n(0,"div",17)(1,"table",18)(2,"thead",19)(3,"tr")(4,"th"),o(5,"Image Name"),t(),n(6,"th"),o(7,"Shared With"),t(),n(8,"th"),o(9,"Shared On"),t(),n(10,"th"),o(11,"Expires On"),t(),n(12,"th",20),o(13,"Actions"),t()()(),n(14,"tbody"),_(15,Qe,18,5,"tr",21)(16,qe,3,0,"tr",22),t()()()),l&2){let e=c();d(15),g("ngForOf",e.sharedImages),d(),g("ngIf",e.sharedImages.length===0)}}function Ze(l,i){if(l&1){let e=M();n(0,"app-image-modal",30),u("closeModal",function(){p(e);let r=c();return m(r.closeModal())}),t()}if(l&2){let e=c();g("image",e.selectedImage)("isEditing",!1)}}var ie=class l{constructor(i,e,a){this.authService=i;this.router=e;this.s3Service=a}sharedImages=[];currentUserId=0;currentUserEmail=null;selectedImage=null;isLoading=!1;ngOnInit(){console.log("\u{1F4CC} Initializing Shared Images Component...");let i=localStorage.getItem("user");if(i){let e=JSON.parse(i);this.currentUserId=e.userId??0,this.currentUserEmail=e.email}if(!this.currentUserId){console.error("\u274C ERROR: No valid user ID found.");return}console.log("\u2705 Current Provider ID:",this.currentUserId),this.fetchSharedFiles()}fetchSharedFiles(){if(!this.currentUserId){console.error("\u274C ERROR: No provider ID found.");return}this.s3Service.getProviderSharedFiles(this.currentUserId).subscribe(i=>{console.log("\u2705 Shared Files Response:",i),this.sharedImages=i.sharedFiles.map(e=>({name:e.file_name,sharedBy:e.uploaded_by,sharedByEmail:e.shared_by_email,sharedWith:e.shared_with,sharedWithName:e.shared_with_name,sharedWithEmail:e.shared_with_email,sharedOn:e.shared_on?new Date(e.shared_on).toLocaleString("en-US",{timeZone:"America/New_York",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",expiresAt:e.expires_at?new Date(e.expires_at).toLocaleString("en-US",{timeZone:"America/New_York",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A"})),console.log("\u{1F4CC} Updated Shared Images List:",this.sharedImages)},i=>{console.error("\u274C ERROR: Failed to fetch shared files",i)})}viewImage(i){this.s3Service.getFileUrl(i.name,i.sharedBy).subscribe(e=>{this.selectedImage=H(k({},i),{viewUrl:e.viewUrl})},e=>{console.error("\u274C ERROR: Failed to generate view URL",e),alert("Unable to view image. Try again.")})}closeModal(){this.selectedImage=null}revokeAccess(i){if(!this.currentUserId){console.error("\u274C ERROR: No provider ID found.");return}if(confirm(`Are you sure you want to revoke access to ${i.name}?`)){let e=Number(i.sharedWith);if(isNaN(e)){console.error("\u274C ERROR: Invalid patient ID (expected a number)");return}this.s3Service.revokeSharedFile(i.name,this.currentUserId,e).subscribe(()=>{alert("\u2705 Access revoked successfully!"),this.fetchSharedFiles()},a=>{console.error("\u274C ERROR: Failed to revoke access",a),alert("\u274C Failed to revoke access. Please try again.")})}}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(h(w),h(O),h(R))};static \u0275cmp=S({type:l,selectors:[["app-shared-images"]],decls:24,vars:3,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"uploaded-images-section"],[1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],["class","loading-spinner mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[3,"image","isEditing","closeModal",4,"ngIf"],[1,"loading-spinner","mb-3"],[1,"fas","fa-spinner","fa-spin"],[1,"table-responsive"],[1,"table","table-striped","table-bordered","align-middle"],[1,"table-primary"],[1,"text-center",2,"width","200px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-center"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-trash"],["colspan","5",1,"text-center","text-muted"],[3,"closeModal","image","isEditing"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Provider Dashboard"),t(),n(3,"a",1),o(4,"Home"),t(),n(5,"a",2),o(6,"Patients"),t(),n(7,"a",3),o(8,"Uploaded Images"),t(),n(9,"a",4),o(10,"Shared Images"),t(),n(11,"a",5),o(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),o(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"div",9)(18,"div",10)(19,"h5",11),o(20,"Shared Images"),t(),_(21,Je,3,0,"div",12)(22,Ge,17,2,"div",13)(23,Ze,1,2,"app-image-modal",14),t()()()()),e&2&&(d(21),g("ngIf",a.isLoading),d(),g("ngIf",!a.isLoading),d(),g("ngIf",a.selectedImage))},dependencies:[N,F,U,I,y,T,Y],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}"]})};var Tt=[{path:"",component:j,canActivate:[V],data:{role:"provider"}},{path:"dashboard",component:j,canActivate:[V],data:{role:"provider"}},{path:"patients",component:ee,canActivate:[V],data:{role:"provider"}},{path:"uploaded-images",component:te,canActivate:[V],data:{role:"provider"}},{path:"shared-images",component:ie,canActivate:[V],data:{role:"provider"}},{path:"profile",component:ne,canActivate:[V],data:{role:"provider"}}];export{Tt as PROVIDER_ROUTES};
