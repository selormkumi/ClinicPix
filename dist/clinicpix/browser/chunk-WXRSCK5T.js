import{a as z,b as ne,c as j,d as ie,e as oe,f as q,g as H,h as re,i as ae,j as le,k as de}from"./chunk-O4NV3PGW.js";import{a as I}from"./chunk-HNC6GMJY.js";import{a as E}from"./chunk-HCZFOQCE.js";import{b as V,f as D,g as X,h as Z,i as L,j as $,k as ee,n as U,o as A,p as W,q as te,t as B}from"./chunk-B3LR5U6O.js";import{j as P,k as w,n as O}from"./chunk-XXUVLGFF.js";import"./chunk-JMZF3PO5.js";import{Bb as Y,Cb as o,Db as b,Eb as f,Gb as h,Hb as _,Ib as x,Oa as l,Ob as K,Pa as y,Za as S,a as k,b as J,cb as C,da as m,ea as p,fc as N,gc as T,ic as F,jb as g,nb as n,ob as t,pb as v,sb as M,ub as u,vb as c}from"./chunk-SUAPDDW3.js";var R=class d{constructor(i,e){this.authService=i;this.router=e}currentUserName="User";ngOnInit(){let i=localStorage.getItem("user");if(i)try{let e=JSON.parse(i);this.currentUserName=e.userName?.trim()||e.username?.trim()||e.name?.trim()||"Unknown",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||d)(y(E),y(P))};static \u0275cmp=S({type:d,selectors:[["app-dashboard"]],decls:29,vars:1,consts:[[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,a){e&1&&(n(0,"body")(1,"div",0)(2,"h2"),o(3,"Patient Dashboard"),t(),n(4,"a",1),o(5,"Home"),t(),n(6,"a",2),o(7,"My Records"),t(),n(8,"a",3),o(9,"Profile"),t(),n(10,"a",4),u("click",function(){return a.logout()}),o(11,"Logout"),t()(),n(12,"div",5)(13,"div",6)(14,"h3"),o(15),t(),n(16,"p"),o(17,"Manage your medical images securely and efficiently."),t()(),n(18,"div",7)(19,"div",8)(20,"h5"),o(21,"Dashboard Overview"),t(),n(22,"p"),o(23,"Welcome to your patient dashboard. Here you can:"),t(),n(24,"ul")(25,"li"),o(26,"Access images shared with you by healthcare providers."),t(),n(27,"li"),o(28,"Update your personal profile and contact information."),t()()()()()()),e&2&&(l(15),f("Welcome, ",a.currentUserName,""))},dependencies:[O,w],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};function he(d,i){d&1&&(n(0,"div",26),v(1,"i",27),o(2," Loading shared images... "),t())}function _e(d,i){if(d&1&&(n(0,"option",28),o(1),t()),d&2){let e=i.$implicit;g("value",e),l(),b(e)}}function xe(d,i){if(d&1&&(n(0,"span"),o(1),t()),d&2){let e=c().$implicit;l(),f("(",e.sharedByEmail,")")}}function Ce(d,i){if(d&1&&(n(0,"span",37),o(1),t()),d&2){let e=i.$implicit;l(),b(e)}}function ye(d,i){if(d&1&&(n(0,"span"),C(1,Ce,2,1,"span",36),t()),d&2){let e=c().$implicit;l(),g("ngForOf",e.tags)}}function be(d,i){d&1&&o(0,"No tags")}function Me(d,i){if(d&1){let e=M();n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),C(5,xe,2,1,"span",23),t(),n(6,"td"),o(7),t(),n(8,"td"),o(9),t(),n(10,"td"),C(11,ye,2,1,"span",29)(12,be,1,0,"ng-template",null,0,K),t(),n(14,"td",30)(15,"div",31)(16,"button",32),u("click",function(){let r=m(e).$implicit,s=c();return p(s.viewImage(r))}),v(17,"i",33),o(18," View "),t(),n(19,"button",34),u("click",function(){let r=m(e).$implicit,s=c();return p(s.openDisclaimer(r))}),v(20,"i",35),o(21," Download "),t()()()()}if(d&2){let e=i.$implicit,a=Y(13);l(2),b(e.name),l(2),f(" ",e.sharedBy," "),l(),g("ngIf",e.sharedByEmail),l(2),b(e.sharedOn),l(2),b(e.expiresAt),l(2),g("ngIf",e.tags.length>0)("ngIfElse",a)}}function Se(d,i){d&1&&(n(0,"tr")(1,"td",38),o(2,"No shared images found."),t()())}function ve(d,i){if(d&1){let e=M();n(0,"app-image-modal",39),u("closeModal",function(){m(e);let r=c();return p(r.closeModal())}),t()}if(d&2){let e=c();g("image",e.selectedImage)}}function Pe(d,i){if(d&1){let e=M();n(0,"div",40)(1,"div",41)(2,"h5",9),o(3,"Download Disclaimer"),t(),n(4,"p"),o(5," Please do not download sensitive medical images on public or shared computers. Proceed only if you are on a trusted device. "),t(),n(6,"div",42)(7,"button",43),u("click",function(){m(e);let r=c();return p(r.cancelDownload())}),o(8,"Cancel"),t(),n(9,"button",44),u("click",function(){m(e);let r=c();return p(r.confirmDownload())}),o(10,"Proceed to Download"),t()()()()}}var Q=class d{constructor(i,e,a){this.authService=i;this.router=e;this.s3Service=a}sharedImages=[];filteredRecords=[];uniqueTags=[];searchQuery="";selectedTag="";selectedImage=null;isEditing=!1;isLoading=!1;currentUserId=0;currentUserName=null;showDisclaimerModal=!1;downloadImagePending=null;ngOnInit(){console.log("\u{1F4CC} Initializing My Records Component...");let i=localStorage.getItem("user");if(i){let e=JSON.parse(i);this.currentUserId=e.userId??0,this.currentUserName=e.username}else console.error("\u274C ERROR: No user found in localStorage");this.currentUserId?console.log("\u2705 Current Patient ID:",this.currentUserId):console.error("\u274C ERROR: No valid user ID found."),this.fetchSharedFiles()}fetchSharedFiles(){if(!this.currentUserId){console.error("\u274C ERROR: User ID is missing. Cannot fetch shared files.");return}this.isLoading=!0,this.s3Service.getSharedFiles(this.currentUserId).subscribe(i=>{console.log("\u2705 Shared Files Retrieved:",i),this.sharedImages=(i.sharedFiles||[]).sort((e,a)=>new Date(a.shared_on).getTime()-new Date(e.shared_on).getTime()).map(e=>({name:e.file_name,sharedBy:e.shared_by||"Unknown",sharedByEmail:e.shared_by_email||"N/A",uploadedBy:e.uploaded_by||0,sharedOn:e.shared_on?new Date(e.shared_on).toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",expiresAt:e.expires_at?new Date(e.expires_at).toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",tags:e.tags?e.tags.split(","):[]})),this.extractUniqueTags(),this.filteredRecords=[...this.sharedImages],this.isLoading=!1},i=>{console.error("\u274C ERROR: Failed to fetch shared files",i),this.isLoading=!1})}extractUniqueTags(){let i=this.sharedImages.flatMap(e=>e.tags);this.uniqueTags=Array.from(new Set(i))}viewImage(i){let e=i.uploadedBy||i.sharedBy;this.s3Service.getFileUrl(i.name,e).subscribe(a=>{this.selectedImage={name:i.name,url:a.viewUrl,tags:i.tags,sharedBy:i.sharedBy,sharedByEmail:i.sharedByEmail}},a=>{console.error("\u274C ERROR: Failed to retrieve file URL",a),alert("Failed to load the image. Please try again.")})}closeModal(){this.selectedImage=null}openDisclaimer(i){this.downloadImagePending=i,this.showDisclaimerModal=!0}confirmDownload(){let i=this.downloadImagePending;if(!i)return;let e=i.uploadedBy||i.sharedBy;this.s3Service.getDownloadUrl(i.name,e).subscribe(a=>{if(a.downloadUrl){let r=document.createElement("a");r.href=a.downloadUrl,r.setAttribute("download",i.name),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else alert("\u274C Error: Download link is unavailable.")},a=>{console.error("\u274C ERROR: Failed to generate download link",a),alert("Failed to download file. Please try again.")}),this.showDisclaimerModal=!1,this.downloadImagePending=null}cancelDownload(){this.showDisclaimerModal=!1,this.downloadImagePending=null}filterRecords(){this.filteredRecords=this.sharedImages.filter(i=>{let e=i.name.toLowerCase().includes(this.searchQuery.toLowerCase())||i.sharedBy.toLowerCase().includes(this.searchQuery.toLowerCase()),a=this.selectedTag?i.tags.includes(this.selectedTag):!0;return e&&a})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(y(E),y(P),y(z))};static \u0275cmp=S({type:d,selectors:[["app-my-records"]],decls:46,vars:8,consts:[["noTags",""],[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],["id","shared-records",1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],[1,"filter-container","d-flex","flex-wrap","gap-3","mb-3"],[1,"flex-grow-1"],["type","text","placeholder","Search...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"table-responsive"],[1,"table","table-striped","table-bordered","align-middle"],[1,"table-primary"],[1,"text-center",2,"width","210px"],[2,"font-size","0.95rem"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"image","closeModal",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[3,"value"],[4,"ngIf","ngIfElse"],[1,"text-center"],[1,"d-flex","justify-content-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-success","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-download"],["class","me-2",4,"ngFor","ngForOf"],[1,"me-2"],["colspan","6",1,"text-center","text-muted"],[3,"closeModal","image"],[1,"modal-overlay"],[1,"modal-content"],[1,"modal-buttons"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(e,a){e&1&&(n(0,"div",1)(1,"h2"),o(2,"Patient Dashboard"),t(),n(3,"a",2),o(4,"Home"),t(),n(5,"a",3),o(6,"My Records"),t(),n(7,"a",4),o(8,"Profile"),t(),n(9,"a",5),u("click",function(){return a.logout()}),o(10,"Logout"),t()(),n(11,"div",6)(12,"div",7)(13,"div",8)(14,"h5",9),o(15,"My Shared Images"),t(),C(16,he,3,0,"div",10),n(17,"div",11)(18,"div",12)(19,"input",13),x("ngModelChange",function(s){return _(a.searchQuery,s)||(a.searchQuery=s),s}),u("input",function(){return a.filterRecords()}),t()(),n(20,"div")(21,"select",14),x("ngModelChange",function(s){return _(a.selectedTag,s)||(a.selectedTag=s),s}),u("change",function(){return a.filterRecords()}),n(22,"option",15),o(23,"All Tags"),t(),C(24,_e,2,2,"option",16),t()()(),n(25,"div",17)(26,"table",18)(27,"thead",19)(28,"tr")(29,"th"),o(30,"Image Name"),t(),n(31,"th"),o(32,"Shared By"),t(),n(33,"th"),o(34,"Shared On"),t(),n(35,"th"),o(36,"Expires At"),t(),n(37,"th"),o(38,"Tag(s)"),t(),n(39,"th",20),o(40,"Actions"),t()()(),n(41,"tbody",21),C(42,Me,22,7,"tr",22)(43,Se,3,0,"tr",23),t()()(),C(44,ve,1,1,"app-image-modal",24)(45,Pe,11,0,"div",25),t()()()),e&2&&(l(16),g("ngIf",a.isLoading),l(3),h("ngModel",a.searchQuery),l(2),h("ngModel",a.selectedTag),l(3),g("ngForOf",a.uniqueTags),l(18),g("ngForOf",a.filteredRecords),l(),g("ngIf",a.filteredRecords.length===0),l(),g("ngIf",a.selectedImage),l(),g("ngIf",a.showDisclaimerModal))},dependencies:[O,w,F,N,T,B,A,W,V,U,D,L,ne],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:25px 30px;width:100%;max-width:400px;box-shadow:0 4px 10px #0003;text-align:center}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1rem;line-height:1.6;word-break:break-word}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:15px;margin-top:20px}"]})};function we(d,i){if(d&1){let e=M();n(0,"div",8)(1,"div",9)(2,"h2"),o(3),t()(),n(4,"div",10)(5,"p")(6,"strong"),o(7,"Email:"),t(),o(8),t(),n(9,"p")(10,"strong"),o(11,"Date of Birth:"),t(),o(12),t(),n(13,"p")(14,"strong"),o(15,"Country:"),t(),o(16),t(),n(17,"p")(18,"strong"),o(19,"State/City:"),t(),o(20),t(),n(21,"p")(22,"strong"),o(23,"Age:"),t(),o(24),t(),n(25,"p")(26,"strong"),o(27,"Weight:"),t(),o(28),t(),n(29,"p")(30,"strong"),o(31,"Height:"),t(),o(32),t(),n(33,"p")(34,"strong"),o(35,"Address:"),t(),o(36),t(),n(37,"p")(38,"strong"),o(39,"Phone:"),t(),o(40),t(),n(41,"button",11),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),o(42,"Edit Profile"),t()()()}if(d&2){let e=c();l(3),b(e.patient.name||"No name"),l(5),f(" ",e.patient.email,""),l(4),f(" ",e.patient.dobFormatted||"Not set",""),l(4),f(" ",e.getCountryName(e.patient.country)||"Not set",""),l(4),f(" ",e.patient.state||"Not set",""),l(4),f(" ",e.patient.age?e.patient.age+" Years":"Not set",""),l(4),f(" ",e.patient.weight?e.patient.weight+" lbs":"Not set",""),l(4),f(" ",e.patient.height?e.patient.height+" cm":"Not set",""),l(4),f(" ",e.patient.address||"Not set",""),l(4),f(" ",(e.patient.phone==null?null:e.patient.phone.internationalNumber)||e.patient.phone||"Not set","")}}function Oe(d,i){if(d&1&&(n(0,"option",39),o(1),t()),d&2){let e=i.$implicit;g("value",e.isoCode),l(),f(" ",e.name," ")}}function Ee(d,i){if(d&1&&(n(0,"option",39),o(1),t()),d&2){let e=i.$implicit;g("value",e.name),l(),b(e.name)}}function Ie(d,i){if(d&1){let e=M();n(0,"div",8)(1,"h3"),o(2,"Edit Profile"),t(),n(3,"form",12),u("ngSubmit",function(){m(e);let r=c();return p(r.saveChanges())}),n(4,"div",13)(5,"label",14),o(6,"Name:"),t(),n(7,"input",15),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.name,r)||(s.patient.name=r),p(r)}),t()(),n(8,"div",13)(9,"label",16),o(10,"Email:"),t(),v(11,"input",17),t(),n(12,"div",13)(13,"label",18),o(14,"Date of Birth:"),t(),n(15,"input",19),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.dob,r)||(s.patient.dob=r),p(r)}),t()(),n(16,"div",13)(17,"label",20),o(18,"Country:"),t(),n(19,"select",21),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.country,r)||(s.patient.country=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getStates(r.patient.country))}),n(20,"option",22),o(21,"Select Country"),t(),C(22,Oe,2,2,"option",23),t()(),n(23,"div",13)(24,"label",24),o(25,"State/City:"),t(),n(26,"select",25),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.state,r)||(s.patient.state=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getCities(r.patient.state))}),n(27,"option",22),o(28,"Select State/City"),t(),C(29,Ee,2,2,"option",23),t()(),n(30,"div",13)(31,"label",26),o(32,"Age:"),t(),n(33,"input",27),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.age,r)||(s.patient.age=r),p(r)}),t()(),n(34,"div",13)(35,"label",28),o(36,"Weight (lbs):"),t(),n(37,"input",29),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.weight,r)||(s.patient.weight=r),p(r)}),t()(),n(38,"div",13)(39,"label",30),o(40,"Height (cm):"),t(),n(41,"input",31),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.height,r)||(s.patient.height=r),p(r)}),t()(),n(42,"div",13)(43,"label",32),o(44,"Address:"),t(),n(45,"input",33),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.address,r)||(s.patient.address=r),p(r)}),t()(),n(46,"div",13)(47,"label",34),o(48,"Phone Number:"),t(),n(49,"ngx-intl-tel-input",35),x("ngModelChange",function(r){m(e);let s=c();return _(s.patient.phone,r)||(s.patient.phone=r),p(r)}),t()(),n(50,"div",36)(51,"button",37),o(52,"Save Changes"),t(),o(53,"\xA0 "),n(54,"button",38),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),o(55,"Cancel"),t()()()()}if(d&2){let e=c();l(7),h("ngModel",e.patient.name),l(4),g("value",e.patient.email),l(4),h("ngModel",e.patient.dob),l(4),h("ngModel",e.patient.country),l(3),g("ngForOf",e.countries),l(4),h("ngModel",e.patient.state),l(3),g("ngForOf",e.states),l(4),h("ngModel",e.patient.age),l(4),h("ngModel",e.patient.weight),l(4),h("ngModel",e.patient.height),l(4),h("ngModel",e.patient.address),l(4),g("cssClass","form-control full-width")("preferredCountries",e.preferredCountries)("enableAutoCountrySelect",!0)("enablePlaceholder",!0)("searchCountryFlag",!0)("searchCountryField",e.searchFields)("selectFirstCountry",!1)("selectedCountryISO",e.patient.country||e.countryISO.UnitedStates)("separateDialCode",!0)("phoneValidation",!0),h("ngModel",e.patient.phone)}}var G=class d{constructor(i,e,a){this.authService=i;this.router=e;this.s3FileService=a}countries=[];states=[];cities=[];patient={email:"",name:"",dob:"",dobFormatted:"",state:"",country:"",age:0,weight:0,height:"",address:"",phone:null};isEditing=!1;currentUserId=0;searchCountryField=H;countryISO=q;phoneNumberFormat=re;searchFields=[H.Iso2,H.Name];preferredCountries=[q.UnitedStates];selectedCountryISO=q.UnitedStates;ngOnInit(){let i=JSON.parse(localStorage.getItem("user")||"{}");this.currentUserId=i.userId,this.currentUserId&&(this.getCountries(),this.fetchProfile())}fetchProfile(){this.s3FileService.getUserById(this.currentUserId).subscribe(i=>{let e=i.country||"",a=i.dob?new Date(i.dob):null,r=i.phone?{number:i.phone,internationalNumber:i.phone,nationalNumber:i.phone,e164Number:i.phone,countryCode:"",dialCode:""}:null;this.patient=J(k(k({},this.patient),i),{country:i.country,dob:a?a.toISOString().split("T")[0]:"",dobFormatted:a?a.toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}).replace(",",""):"",phone:r}),e&&(this.getStates(e),this.selectedCountryISO=e)},i=>{console.error("\u274C Failed to fetch profile",i)})}getCountries(){this.countries=j.getAllCountries()}getCountryName(i){return j.getCountryByCode(i)?.name||i}getStates(i){this.states=ie.getStatesOfCountry(i),this.cities=[],this.selectedCountryISO=i}getCities(i){let e=this.patient.country;this.cities=oe.getCitiesOfState(e,i)}toggleEdit(){this.isEditing=!this.isEditing}saveChanges(){let i=k({},this.patient),e=j.getAllCountries().find(a=>a.isoCode.toLowerCase()===this.patient.country.toLowerCase()||a.name.toLowerCase()===this.patient.country.toLowerCase());i.country=e?.isoCode||this.patient.country,i.phone=this.patient.phone?.internationalNumber||"",this.s3FileService.updateUserProfile(this.currentUserId,i).subscribe(()=>{console.log("\u2705 Profile saved"),alert("Profile updated!"),this.toggleEdit()},a=>{console.error("\u274C Failed to save profile:",a),alert("Failed to update profile.")})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(y(E),y(P),y(z))};static \u0275cmp=S({type:d,selectors:[["app-patient-profile"]],decls:15,vars:2,consts:[[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],[1,"profile-container"],["class","card",4,"ngIf"],[1,"card"],[1,"profile-header"],[1,"profile-details"],[1,"edit-button",3,"click"],[3,"ngSubmit"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","required","",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email","name","email","disabled","",1,"readonly",3,"value"],["for","dob"],["type","date","id","dob","name","dob",3,"ngModelChange","ngModel"],["for","country"],["id","country","name","country",3,"ngModelChange","change","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","state"],["id","state","name","state",3,"ngModelChange","change","ngModel"],["for","age"],["type","number","id","age","name","age",3,"ngModelChange","ngModel"],["for","weight"],["type","number","id","weight","name","weight",3,"ngModelChange","ngModel"],["for","height"],["type","text","id","height","name","height",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address","name","address",3,"ngModelChange","ngModel"],["for","phone"],["name","phone","id","phone",3,"ngModelChange","cssClass","preferredCountries","enableAutoCountrySelect","enablePlaceholder","searchCountryFlag","searchCountryField","selectFirstCountry","selectedCountryISO","separateDialCode","phoneValidation","ngModel"],[1,"form-buttons"],["type","submit",1,"save-button"],["type","button",1,"cancel-button",3,"click"],[3,"value"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Patient Dashboard"),t(),n(3,"a",1),o(4,"Home"),t(),n(5,"a",2),o(6,"My Records"),t(),n(7,"a",3),o(8,"Profile"),t(),n(9,"a",4),u("click",function(){return a.logout()}),o(10,"Logout"),t()(),n(11,"div",5)(12,"div",6),C(13,we,43,10,"div",7)(14,Ie,56,22,"div",7),t()()),e&2&&(l(13),g("ngIf",!a.isEditing),l(),g("ngIf",a.isEditing))},dependencies:[O,w,B,$,A,W,V,ee,U,D,X,te,L,Z,F,N,T,de,le,ae],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.profile-container[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 10px #0000001a;max-width:800px;margin:20px auto}.card[_ngcontent-%COMP%]{background-color:#ecf0f1;padding:20px;border-radius:8px;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:120px;height:120px;margin-bottom:15px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:#34495e;text-align:center}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;line-height:1.6;margin:8px 0;color:#7f8c8d}.edit-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:10px 20px;cursor:pointer;border-radius:4px;font-size:1rem;transition:background-color .3s ease}.edit-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}form[_ngcontent-%COMP%]{display:grid;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:5px;color:#34495e}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:12px;font-size:1rem;border-radius:4px;border:1px solid #bdc3c7;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db}button[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;border:none;cursor:pointer;border-radius:4px;transition:background-color .3s ease}.save-button[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:#27ae60}.cancel-button[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:focus{outline:none}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:20px}@media screen and (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:200px}.main-content[_ngcontent-%COMP%]{margin-left:220px;width:calc(100% - 220px)}.profile-container[_ngcontent-%COMP%]{padding:20px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}"]})};var Ze=[{path:"",component:R,canActivate:[I],data:{role:"patient"}},{path:"dashboard",component:R,canActivate:[I],data:{role:"patient"}},{path:"my-records",component:Q,canActivate:[I],data:{role:"patient"}},{path:"profile",component:G,canActivate:[I],data:{role:"patient"}}];export{Ze as PATIENT_ROUTES};
