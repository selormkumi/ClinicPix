import{a,b as l,j as u,o as g}from"./chunk-7LQAGGHQ.js";import{U as s,X as n,aa as i}from"./chunk-47VD7EEE.js";var m=class o{constructor(t,e){this.http=t;this.router=e}apiUrl=`${g.apiUrl}/auth`;login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(s(e=>{if(e.token&&e.user){this.storeToken(e.token);let r=e.user.userName||"User";localStorage.setItem("user",JSON.stringify({email:e.user.email,userName:r,role:e.user.role,userId:e.user.id})),console.log("\u{1F50D} Stored User:",localStorage.getItem("user"))}}))}signup(t){return this.http.post(`${this.apiUrl}/signup`,t)}storeToken(t){localStorage.setItem("token",t)}getToken(){return localStorage.getItem("token")}isAuthenticated(){return!!this.getToken()}getCurrentUser(){let t=localStorage.getItem("user");if(t)try{return JSON.parse(t)}catch(e){return console.error("\u274C ERROR: Failed to parse user data from localStorage",e),null}return null}logout(){let t=this.getCurrentUser(),e=t?.userId,r=t?.email;e&&r&&this.http.post(`${this.apiUrl}/logout`,{userId:e,email:r}).subscribe({next:()=>console.log("\u{1F4DD} Logout logged"),error:c=>console.error("\u274C Failed to log logout:",c)}),console.log("\u{1F6AA} Logging out..."),localStorage.removeItem("token"),localStorage.removeItem("user"),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to Login Page")})}verifyOtp(t){return t.email||(t.email=localStorage.getItem("email")||""),this.http.post(`${this.apiUrl}/verify-otp`,t)}accessProtectedRoute(){let t=this.getToken(),e=new a().set("Authorization",`Bearer ${t}`);return this.http.post(`${this.apiUrl}/protected`,{},{headers:e})}static \u0275fac=function(e){return new(e||o)(i(l),i(u))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
