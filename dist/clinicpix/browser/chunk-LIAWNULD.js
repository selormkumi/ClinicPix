import{a as z,b as ae,c as q,d as le,e as de,f as H,g as Q,h as se,i as ce,j as me,k as pe}from"./chunk-VA2OBBSF.js";import{a as I,c as j}from"./chunk-GHHRRHJY.js";import{a as E}from"./chunk-AF3QZ4WF.js";import{b as V,f as D,g as te,h as ne,i as B,j as ie,k as oe,n as L,o as U,p as A,q as re,t as W}from"./chunk-UKKNGMUV.js";import{j as P,k as w,n as O}from"./chunk-7LQAGGHQ.js";import"./chunk-RWGEFZSS.js";import{Bb as u,Db as c,Jb as K,Kb as i,Lb as b,Mb as f,Ob as _,Pb as x,Qb as C,Ta as l,Ua as h,Ub as X,Vb as Z,Xb as $,a as R,b as Y,db as S,ha as m,ia as p,ib as y,pb as g,pc as N,qc as T,rc as ee,sc as F,ub as n,vb as t,wb as v,zb as M}from"./chunk-47VD7EEE.js";var k=class d{constructor(o,e){this.authService=o;this.router=e}currentUserName="User";ngOnInit(){let o=localStorage.getItem("user");if(o)try{let e=JSON.parse(o);this.currentUserName=e.userName?.trim()||e.username?.trim()||e.name?.trim()||"Unknown",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||d)(h(E),h(P))};static \u0275cmp=S({type:d,selectors:[["app-dashboard"]],decls:29,vars:1,consts:[[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,a){e&1&&(n(0,"body")(1,"div",0)(2,"h2"),i(3,"Patient Dashboard"),t(),n(4,"a",1),i(5,"Home"),t(),n(6,"a",2),i(7,"My Records"),t(),n(8,"a",3),i(9,"Profile"),t(),n(10,"a",4),u("click",function(){return a.logout()}),i(11,"Logout"),t()(),n(12,"div",5)(13,"div",6)(14,"h3"),i(15),t(),n(16,"p"),i(17,"Manage your medical images securely and efficiently."),t()(),n(18,"div",7)(19,"div",8)(20,"h5"),i(21,"Dashboard Overview"),t(),n(22,"p"),i(23,"Welcome to your patient dashboard. Here you can:"),t(),n(24,"ul")(25,"li"),i(26,"Access images shared with you by healthcare providers."),t(),n(27,"li"),i(28,"Update your personal profile and contact information."),t()()()()()()),e&2&&(l(15),f("Welcome, ",a.currentUserName,""))},dependencies:[O,w],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};function be(d,o){d&1&&(n(0,"div",26),v(1,"i",27),i(2," Loading shared images... "),t())}function Me(d,o){if(d&1&&(n(0,"option",28),i(1),t()),d&2){let e=o.$implicit;g("value",e),l(),b(e)}}function Se(d,o){if(d&1&&(n(0,"span"),i(1),t()),d&2){let e=c().$implicit;l(),f("(",e.sharedByEmail,")")}}function ve(d,o){if(d&1&&(n(0,"span",37),i(1),t()),d&2){let e=o.$implicit;l(),b(e)}}function Pe(d,o){if(d&1&&(n(0,"span"),y(1,ve,2,1,"span",36),t()),d&2){let e=c().$implicit;l(),g("ngForOf",e.tags)}}function we(d,o){d&1&&i(0,"No tags")}function Oe(d,o){if(d&1){let e=M();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),y(5,Se,2,1,"span",23),t(),n(6,"td"),i(7),t(),n(8,"td"),i(9),t(),n(10,"td"),y(11,Pe,2,1,"span",29)(12,we,1,0,"ng-template",null,0,$),t(),n(14,"td",30)(15,"div",31)(16,"button",32),u("click",function(){let r=m(e).$implicit,s=c();return p(s.viewImage(r))}),v(17,"i",33),i(18," View "),t(),n(19,"button",34),u("click",function(){let r=m(e).$implicit,s=c();return p(s.openDisclaimer(r))}),v(20,"i",35),i(21," Download "),t()()()()}if(d&2){let e=o.$implicit,a=K(13);l(2),b(e.name),l(2),f(" ",e.sharedBy," "),l(),g("ngIf",e.sharedByEmail),l(2),b(e.sharedOn),l(2),b(e.expiresAt),l(2),g("ngIf",e.tags.length>0)("ngIfElse",a)}}function Ee(d,o){d&1&&(n(0,"tr")(1,"td",38),i(2,"No shared images found."),t()())}function Ie(d,o){if(d&1){let e=M();n(0,"app-image-modal",39),u("closeModal",function(){m(e);let r=c();return p(r.closeModal())}),t()}if(d&2){let e=c();g("image",e.selectedImage)}}function ke(d,o){if(d&1){let e=M();n(0,"div",40)(1,"div",41)(2,"h4",42),i(3,"Download Disclaimer"),t(),n(4,"p",43),i(5," By downloading "),n(6,"strong"),i(7),t(),i(8,", you acknowledge that this file may contain sensitive information. Do not download on public or shared devices. Proceed only on a trusted device. "),t(),n(9,"div",44)(10,"button",45),u("click",function(){m(e);let r=c();return p(r.cancelDownload())}),i(11,"Cancel"),t(),n(12,"button",46),u("click",function(){m(e);let r=c();return p(r.confirmDownload())}),i(13,"Download"),t()()()()}if(d&2){let e=c();l(7),b(e.downloadImagePending==null?null:e.downloadImagePending.name)}}var G=class d{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3Service=a;this.snackBar=r}sharedImages=[];filteredRecords=[];uniqueTags=[];searchQuery="";selectedTag="";selectedImage=null;isEditing=!1;isLoading=!1;currentUserId=0;currentUserName=null;showDisclaimerModal=!1;downloadImagePending=null;ngOnInit(){console.log("\u{1F4CC} Initializing My Records Component...");let o=localStorage.getItem("user");if(o){let e=JSON.parse(o);this.currentUserId=e.userId??0,this.currentUserName=e.username}else console.error("\u274C ERROR: No user found in localStorage");this.currentUserId?console.log("\u2705 Current Patient ID:",this.currentUserId):console.error("\u274C ERROR: No valid user ID found."),this.fetchSharedFiles()}fetchSharedFiles(){if(!this.currentUserId){console.error("\u274C ERROR: User ID is missing. Cannot fetch shared files.");return}this.isLoading=!0,this.s3Service.getSharedFiles(this.currentUserId).subscribe(o=>{console.log("\u2705 Shared Files Retrieved:",o),this.sharedImages=(o.sharedFiles||[]).sort((e,a)=>new Date(a.shared_on).getTime()-new Date(e.shared_on).getTime()).map(e=>({name:e.file_name,sharedBy:e.shared_by||"Unknown",sharedByEmail:e.shared_by_email||"N/A",uploadedBy:e.uploaded_by||0,sharedOn:e.shared_on?new Date(e.shared_on).toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",expiresAt:e.expires_at?new Date(e.expires_at).toLocaleString("en-US",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",tags:e.tags?e.tags.split(","):[]})),this.extractUniqueTags(),this.filteredRecords=[...this.sharedImages],this.isLoading=!1},o=>{console.error("\u274C ERROR: Failed to fetch shared files",o),this.isLoading=!1})}extractUniqueTags(){let o=this.sharedImages.flatMap(e=>e.tags);this.uniqueTags=Array.from(new Set(o))}viewImage(o){let e=o.uploadedBy||o.sharedBy;this.s3Service.getFileUrl(o.name,e).subscribe(a=>{this.selectedImage={name:o.name,url:a.viewUrl,tags:o.tags,sharedBy:o.sharedBy,sharedByEmail:o.sharedByEmail}},a=>{console.error("\u274C ERROR: Failed to retrieve file URL",a),alert("Failed to load the image. Please try again.")})}closeModal(){this.selectedImage=null}openDisclaimer(o){this.downloadImagePending=o,this.showDisclaimerModal=!0}confirmDownload(){let o=this.downloadImagePending;if(!o)return;let e=o.uploadedBy||o.sharedBy;this.s3Service.getDownloadUrl(o.name,e).subscribe(a=>{if(a.downloadUrl){let r=document.createElement("a");r.href=a.downloadUrl,r.setAttribute("download",o.name),document.body.appendChild(r),r.click(),document.body.removeChild(r),this.snackBar.open("\u2705 Download started","Close")}else this.snackBar.open("\u274C Download link unavailable","Close")},a=>{console.error("\u274C ERROR: Failed to generate download link",a),this.snackBar.open("\u274C Failed to download file","Close",{duration:3e3})}),this.showDisclaimerModal=!1,this.downloadImagePending=null}cancelDownload(){this.showDisclaimerModal=!1,this.downloadImagePending=null}filterRecords(){this.filteredRecords=this.sharedImages.filter(o=>{let e=o.name.toLowerCase().includes(this.searchQuery.toLowerCase())||o.sharedBy.toLowerCase().includes(this.searchQuery.toLowerCase()),a=this.selectedTag?o.tags.includes(this.selectedTag):!0;return e&&a})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(h(E),h(P),h(z),h(j))};static \u0275cmp=S({type:d,selectors:[["app-my-records"]],decls:46,vars:8,consts:[["noTags",""],[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],["id","shared-records",1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],["class","text-center mb-3",4,"ngIf"],[1,"filter-container","d-flex","flex-wrap","gap-3","mb-3"],[1,"flex-grow-1"],["type","text","placeholder","Search...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"table-responsive"],[1,"table","table-striped","table-bordered","align-middle"],[1,"table-primary"],[1,"text-center",2,"width","210px"],[2,"font-size","0.95rem"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"image","closeModal",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"text-center","mb-3"],[1,"fas","fa-spinner","fa-spin","me-2"],[3,"value"],[4,"ngIf","ngIfElse"],[1,"text-center"],[1,"d-flex","justify-content-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-success","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-download"],["class","me-2",4,"ngFor","ngForOf"],[1,"me-2"],["colspan","6",1,"text-center","text-muted"],[3,"closeModal","image"],[1,"modal-overlay"],[1,"modal-box"],[1,"modal-title"],[1,"modal-message"],[1,"modal-buttons"],[1,"modal-btn","cancel",3,"click"],[1,"modal-btn","delete",3,"click"]],template:function(e,a){e&1&&(n(0,"div",1)(1,"h2"),i(2,"Patient Dashboard"),t(),n(3,"a",2),i(4,"Home"),t(),n(5,"a",3),i(6,"My Records"),t(),n(7,"a",4),i(8,"Profile"),t(),n(9,"a",5),u("click",function(){return a.logout()}),i(10,"Logout"),t()(),n(11,"div",6)(12,"div",7)(13,"div",8)(14,"h5",9),i(15,"My Shared Images"),t(),y(16,be,3,0,"div",10),n(17,"div",11)(18,"div",12)(19,"input",13),C("ngModelChange",function(s){return x(a.searchQuery,s)||(a.searchQuery=s),s}),u("input",function(){return a.filterRecords()}),t()(),n(20,"div")(21,"select",14),C("ngModelChange",function(s){return x(a.selectedTag,s)||(a.selectedTag=s),s}),u("change",function(){return a.filterRecords()}),n(22,"option",15),i(23,"All Tags"),t(),y(24,Me,2,2,"option",16),t()()(),n(25,"div",17)(26,"table",18)(27,"thead",19)(28,"tr")(29,"th"),i(30,"Image Name"),t(),n(31,"th"),i(32,"Shared By"),t(),n(33,"th"),i(34,"Shared On"),t(),n(35,"th"),i(36,"Expires At"),t(),n(37,"th"),i(38,"Tag(s)"),t(),n(39,"th",20),i(40,"Actions"),t()()(),n(41,"tbody",21),y(42,Oe,22,7,"tr",22)(43,Ee,3,0,"tr",23),t()()(),y(44,Ie,1,1,"app-image-modal",24)(45,ke,14,1,"div",25),t()()()),e&2&&(l(16),g("ngIf",a.isLoading),l(3),_("ngModel",a.searchQuery),l(2),_("ngModel",a.selectedTag),l(3),g("ngForOf",a.uniqueTags),l(18),g("ngForOf",a.filteredRecords),l(),g("ngIf",a.filteredRecords.length===0),l(),g("ngIf",a.selectedImage),l(),g("ngIf",a.showDisclaimerModal))},dependencies:[O,w,F,N,T,W,U,A,V,L,D,B,ae],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#0006;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-box[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:420px;text-align:left;box-shadow:0 5px 20px #0003}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.modal-message[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:1.5rem;color:#333}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.modal-btn[_ngcontent-%COMP%]{padding:.5rem 1.25rem;font-size:.9rem;border:none;border-radius:6px;cursor:pointer}.modal-btn.cancel[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.modal-btn.delete[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}"]})};function Re(d,o){if(d&1){let e=M();n(0,"div",8)(1,"div",9)(2,"h2"),i(3),t()(),n(4,"div",10)(5,"p")(6,"strong"),i(7,"Email:"),t(),i(8),t(),n(9,"p")(10,"strong"),i(11,"Date of Birth:"),t(),i(12),X(13,"date"),t(),n(14,"p")(15,"strong"),i(16,"Country:"),t(),i(17),t(),n(18,"p")(19,"strong"),i(20,"State/City:"),t(),i(21),t(),n(22,"p")(23,"strong"),i(24,"Age:"),t(),i(25),t(),n(26,"p")(27,"strong"),i(28,"Weight:"),t(),i(29),t(),n(30,"p")(31,"strong"),i(32,"Height:"),t(),i(33),t(),n(34,"p")(35,"strong"),i(36,"Address:"),t(),i(37),t(),n(38,"p")(39,"strong"),i(40,"Phone:"),t(),i(41),t(),n(42,"button",11),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),i(43,"Edit Profile"),t()()()}if(d&2){let e=c();l(3),b(e.patient.name||"No name"),l(5),f(" ",e.patient.email,""),l(4),f(" ",Z(13,10,e.patient.dobFormatted,"MMM d, y"),""),l(5),f(" ",e.getCountryName(e.patient.country)||"Not set",""),l(4),f(" ",e.patient.state||"Not set",""),l(4),f(" ",e.patient.age?e.patient.age+" Years":"Not set",""),l(4),f(" ",e.patient.weight?e.patient.weight+" lbs":"Not set",""),l(4),f(" ",e.patient.height?e.patient.height+" cm":"Not set",""),l(4),f(" ",e.patient.address||"Not set",""),l(4),f(" ",(e.patient.phone==null?null:e.patient.phone.internationalNumber)||e.patient.phone||"Not set","")}}function Ne(d,o){if(d&1&&(n(0,"option",39),i(1),t()),d&2){let e=o.$implicit;g("value",e.isoCode),l(),f(" ",e.name," ")}}function Te(d,o){if(d&1&&(n(0,"option",39),i(1),t()),d&2){let e=o.$implicit;g("value",e.name),l(),b(e.name)}}function Fe(d,o){if(d&1){let e=M();n(0,"div",8)(1,"h3"),i(2,"Edit Profile"),t(),n(3,"form",12),u("ngSubmit",function(){m(e);let r=c();return p(r.saveChanges())}),n(4,"div",13)(5,"label",14),i(6,"Name:"),t(),n(7,"input",15),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.name,r)||(s.patient.name=r),p(r)}),t()(),n(8,"div",13)(9,"label",16),i(10,"Email:"),t(),v(11,"input",17),t(),n(12,"div",13)(13,"label",18),i(14,"Date of Birth:"),t(),n(15,"input",19),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.dob,r)||(s.patient.dob=r),p(r)}),t()(),n(16,"div",13)(17,"label",20),i(18,"Country:"),t(),n(19,"select",21),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.country,r)||(s.patient.country=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getStates(r.patient.country))}),n(20,"option",22),i(21,"Select Country"),t(),y(22,Ne,2,2,"option",23),t()(),n(23,"div",13)(24,"label",24),i(25,"State/City:"),t(),n(26,"select",25),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.state,r)||(s.patient.state=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getCities(r.patient.state))}),n(27,"option",22),i(28,"Select State/City"),t(),y(29,Te,2,2,"option",23),t()(),n(30,"div",13)(31,"label",26),i(32,"Age:"),t(),n(33,"input",27),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.age,r)||(s.patient.age=r),p(r)}),t()(),n(34,"div",13)(35,"label",28),i(36,"Weight (lbs):"),t(),n(37,"input",29),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.weight,r)||(s.patient.weight=r),p(r)}),t()(),n(38,"div",13)(39,"label",30),i(40,"Height (cm):"),t(),n(41,"input",31),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.height,r)||(s.patient.height=r),p(r)}),t()(),n(42,"div",13)(43,"label",32),i(44,"Address:"),t(),n(45,"input",33),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.address,r)||(s.patient.address=r),p(r)}),t()(),n(46,"div",13)(47,"label",34),i(48,"Phone Number:"),t(),n(49,"ngx-intl-tel-input",35),C("ngModelChange",function(r){m(e);let s=c();return x(s.patient.phone,r)||(s.patient.phone=r),p(r)}),t()(),n(50,"div",36)(51,"button",37),i(52,"Save Changes"),t(),i(53,"\xA0 "),n(54,"button",38),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),i(55,"Cancel"),t()()()()}if(d&2){let e=c();l(7),_("ngModel",e.patient.name),l(4),g("value",e.patient.email),l(4),_("ngModel",e.patient.dob),l(4),_("ngModel",e.patient.country),l(3),g("ngForOf",e.countries),l(4),_("ngModel",e.patient.state),l(3),g("ngForOf",e.states),l(4),_("ngModel",e.patient.age),l(4),_("ngModel",e.patient.weight),l(4),_("ngModel",e.patient.height),l(4),_("ngModel",e.patient.address),l(4),g("cssClass","form-control full-width")("preferredCountries",e.preferredCountries)("enableAutoCountrySelect",!0)("enablePlaceholder",!0)("searchCountryFlag",!0)("searchCountryField",e.searchFields)("selectFirstCountry",!1)("selectedCountryISO",e.patient.country||e.countryISO.UnitedStates)("separateDialCode",!0)("phoneValidation",!0),_("ngModel",e.patient.phone)}}var J=class d{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3FileService=a;this.snackBar=r}countries=[];states=[];cities=[];patient={email:"",name:"",dob:"",dobFormatted:"",state:"",country:"",age:0,weight:0,height:"",address:"",phone:null};isEditing=!1;currentUserId=0;searchCountryField=Q;countryISO=H;phoneNumberFormat=se;searchFields=[Q.Iso2,Q.Name];preferredCountries=[H.UnitedStates];selectedCountryISO=H.UnitedStates;ngOnInit(){let o=JSON.parse(localStorage.getItem("user")||"{}");this.currentUserId=o.userId,this.currentUserId&&(this.getCountries(),this.fetchProfile())}fetchProfile(){this.s3FileService.getUserById(this.currentUserId).subscribe(o=>{let e=o.country||"",a=o.phone?{number:o.phone,internationalNumber:o.phone,nationalNumber:o.phone,e164Number:o.phone,countryCode:"",dialCode:""}:null;this.patient=Y(R(R({},this.patient),o),{country:o.country,dob:o.dob||"",dobFormatted:o.dob||"",phone:a}),e&&(this.getStates(e),this.selectedCountryISO=e)},o=>{console.error("\u274C Failed to fetch profile",o)})}getCountries(){this.countries=q.getAllCountries()}getCountryName(o){return q.getCountryByCode(o)?.name||o}getStates(o){this.states=le.getStatesOfCountry(o),this.cities=[],this.selectedCountryISO=o}getCities(o){let e=this.patient.country;this.cities=de.getCitiesOfState(e,o)}toggleEdit(){this.isEditing=!this.isEditing}saveChanges(){let o=R({},this.patient),e=q.getAllCountries().find(a=>a.isoCode.toLowerCase()===this.patient.country.toLowerCase()||a.name.toLowerCase()===this.patient.country.toLowerCase());o.country=e?.isoCode||this.patient.country,o.phone=this.patient.phone?.internationalNumber||"",this.s3FileService.updateUserProfile(this.currentUserId,o).subscribe(()=>{console.log("\u2705 Profile saved"),this.snackBar.open("\u2705 Profile updated!","Close",{duration:3e3}),this.toggleEdit(),this.fetchProfile()},a=>{console.error("\u274C Failed to save profile:",a),this.snackBar.open("\u274C Failed to update profile.","Close",{duration:3e3})})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||d)(h(E),h(P),h(z),h(j))};static \u0275cmp=S({type:d,selectors:[["app-patient-profile"]],decls:15,vars:2,consts:[[1,"sidebar"],["routerLink","/patient/dashboard"],["routerLink","/patient/my-records"],["routerLink","/patient/profile"],["href","#",3,"click"],[1,"main-content"],[1,"profile-container"],["class","card",4,"ngIf"],[1,"card"],[1,"profile-header"],[1,"profile-details"],[1,"edit-button",3,"click"],[3,"ngSubmit"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","required","",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email","name","email","disabled","",1,"readonly",3,"value"],["for","dob"],["type","date","id","dob","name","dob",3,"ngModelChange","ngModel"],["for","country"],["id","country","name","country",3,"ngModelChange","change","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","state"],["id","state","name","state",3,"ngModelChange","change","ngModel"],["for","age"],["type","number","id","age","name","age",3,"ngModelChange","ngModel"],["for","weight"],["type","number","id","weight","name","weight",3,"ngModelChange","ngModel"],["for","height"],["type","text","id","height","name","height",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address","name","address",3,"ngModelChange","ngModel"],["for","phone"],["name","phone","id","phone",3,"ngModelChange","cssClass","preferredCountries","enableAutoCountrySelect","enablePlaceholder","searchCountryFlag","searchCountryField","selectFirstCountry","selectedCountryISO","separateDialCode","phoneValidation","ngModel"],[1,"form-buttons"],["type","submit",1,"save-button"],["type","button",1,"cancel-button",3,"click"],[3,"value"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),i(2,"Patient Dashboard"),t(),n(3,"a",1),i(4,"Home"),t(),n(5,"a",2),i(6,"My Records"),t(),n(7,"a",3),i(8,"Profile"),t(),n(9,"a",4),u("click",function(){return a.logout()}),i(10,"Logout"),t()(),n(11,"div",5)(12,"div",6),y(13,Re,44,13,"div",7)(14,Fe,56,22,"div",7),t()()),e&2&&(l(13),g("ngIf",!a.isEditing),l(),g("ngIf",a.isEditing))},dependencies:[O,w,W,ie,U,A,V,oe,L,D,te,re,B,ne,F,N,T,ee,pe,me,ce],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.profile-container[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 10px #0000001a;max-width:800px;margin:20px auto}.card[_ngcontent-%COMP%]{background-color:#ecf0f1;padding:20px;border-radius:8px;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:120px;height:120px;margin-bottom:15px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:#34495e;text-align:center}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;line-height:1.6;margin:8px 0;color:#7f8c8d}.edit-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:10px 20px;cursor:pointer;border-radius:4px;font-size:1rem;transition:background-color .3s ease}.edit-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}form[_ngcontent-%COMP%]{display:grid;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:5px;color:#34495e}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:12px;font-size:1rem;border-radius:4px;border:1px solid #bdc3c7;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db}button[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;border:none;cursor:pointer;border-radius:4px;transition:background-color .3s ease}.save-button[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:#27ae60}.cancel-button[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:focus{outline:none}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:20px}@media screen and (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:200px}.main-content[_ngcontent-%COMP%]{margin-left:220px;width:calc(100% - 220px)}.profile-container[_ngcontent-%COMP%]{padding:20px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}"]})};var it=[{path:"",component:k,canActivate:[I],data:{role:"patient"}},{path:"dashboard",component:k,canActivate:[I],data:{role:"patient"}},{path:"my-records",component:G,canActivate:[I],data:{role:"patient"}},{path:"profile",component:J,canActivate:[I],data:{role:"patient"}}];export{it as PATIENT_ROUTES};
