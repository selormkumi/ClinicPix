import{a as V,b as G,c as Z,d as Oe,e as ye,f as K,g as X,h as Ie,i as we,j as ke,k as Ee}from"./chunk-VA2OBBSF.js";import{a as Re}from"./chunk-K7RTRRKJ.js";import{a as D,c as N}from"./chunk-GHHRRHJY.js";import{a as w}from"./chunk-AF3QZ4WF.js";import{b as L,f as B,g as Ce,h as ve,i as z,j as Pe,k as Me,n as A,o as W,p as j,q as Se,t as U}from"./chunk-UKKNGMUV.js";import{j as O,k as y,n as I}from"./chunk-7LQAGGHQ.js";import"./chunk-RWGEFZSS.js";import{Bb as u,Db as c,Gb as me,Hb as pe,Ib as ge,Jb as ue,Kb as i,Lb as h,Mb as x,Nb as J,Ob as C,Pb as v,Qb as P,Sb as fe,Ta as d,Ua as f,Ub as Q,Vb as _e,Wb as he,Xb as xe,a as E,b as H,db as S,f as Te,ha as m,ia as p,ib as _,oc as be,pb as g,pc as F,qc as T,rc as q,sc as R,ub as n,vb as t,wb as M,zb as b}from"./chunk-47VD7EEE.js";var Y=class l{constructor(o,e){this.authService=o;this.router=e}currentUserName="User";ngOnInit(){let o=localStorage.getItem("user");if(o)try{let e=JSON.parse(o);this.currentUserName=e.userName?.trim()||e.username?.trim()||"User",console.log("\u{1F50D} Loaded User:",e)}catch(e){console.error("\u274C ERROR: Failed to parse user data from localStorage",e),this.currentUserName="User"}else console.warn("\u26A0\uFE0F WARNING: No user data found in localStorage.")}logout(){this.authService.logout(),this.router.navigate(["/auth/login"]).then(()=>{console.log("\u2705 Redirected to login page")})}static \u0275fac=function(e){return new(e||l)(f(w),f(O))};static \u0275cmp=S({type:l,selectors:[["app-dashboard"]],decls:34,vars:1,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"header"],["id","home",1,"card"],[1,"card-body"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),i(2,"Provider Dashboard"),t(),n(3,"a",1),i(4,"Home"),t(),n(5,"a",2),i(6,"Patients"),t(),n(7,"a",3),i(8,"Uploaded Images"),t(),n(9,"a",4),i(10,"Shared Images"),t(),n(11,"a",5),i(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),i(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"h3"),i(18),t(),n(19,"p"),i(20,"Manage your patients and medical image sharing efficiently."),t()(),n(21,"div",9)(22,"div",10)(23,"h5"),i(24,"Dashboard Overview"),t(),n(25,"p"),i(26,"Welcome to your healthcare provider dashboard. Here you can:"),t(),n(27,"ul")(28,"li"),i(29,"View and manage your patients' uploaded images."),t(),n(30,"li"),i(31,"Share images securely with your patients."),t(),n(32,"li"),i(33,"Update your profile and contact information."),t()()()()()),e&2&&(d(18),x("Welcome, ",a.currentUserName,""))},dependencies:[I,y],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.header[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:15px;border-radius:5px;margin-bottom:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff}.btn-primary[_ngcontent-%COMP%]{background-color:#3498db;border:none}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#2980b9}.card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 2px 4px #0000001a}.card[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:15px}"]})};function Ue(l,o){if(l&1&&(n(0,"option",26),i(1),t()),l&2){let e=o.$implicit;g("value",e.email),d(),J(" ",e.username," (",e.email,") ")}}function Ve(l,o){if(l&1){let e=b();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),t(),n(5,"td"),i(6),t(),n(7,"td",27)(8,"div",28)(9,"button",29),u("click",function(){let r=m(e).$implicit,s=c();return p(s.removePatient(r))}),M(10,"i",30),i(11," Remove "),t()()()()}if(l&2){let e=o.$implicit;d(2),h(e.username),d(2),h(e.email),d(2),h(e.phone)}}function Ne(l,o){l&1&&(n(0,"tr")(1,"td",31),i(2,"No patients found."),t()())}function De(l,o){if(l&1){let e=b();n(0,"div",32)(1,"div",33)(2,"h4",34),i(3,"Remove Patient"),t(),n(4,"p",35),i(5," Are you sure you want to remove "),n(6,"strong"),i(7),t(),i(8," ("),n(9,"span",36),i(10),t(),i(11,")? "),t(),n(12,"div",37)(13,"button",38),u("click",function(){m(e);let r=c();return p(r.cancelRemove())}),i(14,"Cancel"),t(),n(15,"button",39),u("click",function(){m(e);let r=c();return p(r.confirmRemove())}),i(16,"Remove"),t()()()()}if(l&2){let e=c();d(7),h(e.patientToRemove==null?null:e.patientToRemove.username),d(3),h(e.patientToRemove==null?null:e.patientToRemove.email)}}var ie=class l{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3FileService=a;this.snackBar=r}searchTerm="";patients=[];filteredPatients=[];newPatientEmail="";selectedPatientEmail="";availablePatientEmails=[];showRemoveModal=!1;patientToRemove=null;ngOnInit(){localStorage.getItem("user")?(this.loadPatients(),this.fetchAvailablePatientEmails()):console.error("\u274C No current user found in localStorage.")}onSearch(){this.filteredPatients=this.patients.filter(o=>o.name?.toLowerCase().includes(this.searchTerm.toLowerCase())||o.email?.toLowerCase().includes(this.searchTerm.toLowerCase())||o.phone?.includes(this.searchTerm))}assignPatient(){if(!this.selectedPatientEmail){this.snackBar.open("Please select a patient email.");return}let e=JSON.parse(localStorage.getItem("user")||"{}").userId;if(!e){this.snackBar.open("No valid provider ID found.");return}this.s3FileService.assignPatient(e,this.selectedPatientEmail).subscribe(()=>{this.snackBar.open("\u2705 Patient assigned!"),this.selectedPatientEmail="",this.loadPatients(),this.fetchAvailablePatientEmails()},a=>{console.error("\u274C ERROR assigning patient",a),this.snackBar.open(a?.error?.error||"Failed to assign patient.")})}loadPatients(){let e=JSON.parse(localStorage.getItem("user")||"{}").userId;if(!e){console.error("\u274C No valid provider ID found.");return}this.s3FileService.getPatientsByProvider(e).subscribe(a=>{this.patients=a.patients||[],this.filteredPatients=this.patients},a=>{console.error("\u274C ERROR loading patients",a)})}fetchAvailablePatientEmails(){let e=JSON.parse(localStorage.getItem("user")||"{}").userId;e&&this.s3FileService.getAllPatientEmails(e).subscribe(a=>{this.availablePatientEmails=a.patients||[]},a=>{console.error("\u274C ERROR fetching emails",a)})}removePatient(o){this.patientToRemove=o,this.showRemoveModal=!0}confirmRemove(){let e=JSON.parse(localStorage.getItem("user")||"{}").userId;!this.patientToRemove||!e||(this.s3FileService.unassignPatient(e,this.patientToRemove.id).subscribe(()=>{this.snackBar.open("\u2705 Patient removed."),this.loadPatients(),this.fetchAvailablePatientEmails()},a=>{console.error("\u274C ERROR unassigning patient",a),this.snackBar.open("Failed to remove patient.")}),this.showRemoveModal=!1,this.patientToRemove=null)}cancelRemove(){this.showRemoveModal=!1,this.patientToRemove=null}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(f(w),f(O),f(V),f(N))};static \u0275cmp=S({type:l,selectors:[["app-patients"]],decls:45,vars:6,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"mb-3","d-flex","justify-content-between","align-items-center"],["type","text","placeholder","Search Patients...",1,"form-control","w-50",3,"ngModelChange","input","ngModel"],["id","patients",1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],[1,"add-patient-form","mb-4","d-flex","flex-wrap","gap-2","align-items-center"],[1,"form-select","form-select-sm","custom-select-width",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-striped","align-middle","table-bordered"],[1,"table-primary"],[1,"text-center",2,"width","160px"],[2,"font-size","1rem"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"text-center"],[1,"d-flex","justify-content-center","gap-2","flex-wrap"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 10px",3,"click"],[1,"fas","fa-trash","me-1"],["colspan","4",1,"text-center","text-muted"],[1,"modal-overlay"],[1,"modal-box"],[1,"modal-title"],[1,"modal-message"],[1,"text-muted"],[1,"modal-buttons"],[1,"modal-btn","cancel",3,"click"],[1,"modal-btn","delete",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),i(2,"Provider Dashboard"),t(),n(3,"a",1),i(4,"Home"),t(),n(5,"a",2),i(6,"Patients"),t(),n(7,"a",3),i(8,"Uploaded Images"),t(),n(9,"a",4),i(10,"Shared Images"),t(),n(11,"a",5),i(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),i(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"input",9),P("ngModelChange",function(s){return v(a.searchTerm,s)||(a.searchTerm=s),s}),u("input",function(){return a.onSearch()}),t()(),n(18,"div",10)(19,"div",11)(20,"h5",12),i(21,"Patients"),t(),n(22,"div",13)(23,"select",14),P("ngModelChange",function(s){return v(a.selectedPatientEmail,s)||(a.selectedPatientEmail=s),s}),n(24,"option",15),i(25,"Select a patient"),t(),_(26,Ue,2,3,"option",16),t(),n(27,"button",17),u("click",function(){return a.assignPatient()}),i(28,"+ Add Patient"),t()(),n(29,"div",18)(30,"table",19)(31,"thead",20)(32,"tr")(33,"th"),i(34,"Username"),t(),n(35,"th"),i(36,"Email"),t(),n(37,"th"),i(38,"Phone"),t(),n(39,"th",21),i(40,"Actions"),t()()(),n(41,"tbody",22),_(42,Ve,12,3,"tr",23)(43,Ne,3,0,"tr",24),t()()(),_(44,De,17,2,"div",25),t()()()),e&2&&(d(17),C("ngModel",a.searchTerm),d(6),C("ngModel",a.selectedPatientEmail),d(3),g("ngForOf",a.availablePatientEmails),d(16),g("ngForOf",a.filteredPatients),d(),g("ngIf",a.filteredPatients.length===0),d(),g("ngIf",a.showRemoveModal))},dependencies:[I,y,U,W,j,L,A,B,z,R,F,T],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}.custom-select-width[_ngcontent-%COMP%]{width:500px!important}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-box[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:420px;box-shadow:0 5px 20px #0003;text-align:left}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.modal-message[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:1.5rem}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem}.modal-btn[_ngcontent-%COMP%]{padding:.5rem 1.25rem;font-size:.9rem;border:none;border-radius:6px;cursor:pointer}.modal-btn.cancel[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.modal-btn.delete[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}"]})};var Le=["fileInput"],Be=l=>({dragging:l});function ze(l,o){l&1&&(n(0,"p",32)(1,"strong"),i(2,"Drag & drop an image file here"),t()())}function Ae(l,o){if(l&1&&(n(0,"p",32)(1,"strong"),i(2),t()()),l&2){let e=c();d(2),x("Selected: ",e.pendingFile.name,"")}}function We(l,o){if(l&1&&(n(0,"span"),i(1),t()),l&2){let e=c().$implicit;d(),x("(",e.uploaderEmail,")")}}function je(l,o){if(l&1&&(n(0,"span",43),i(1),t()),l&2){let e=o.$implicit;d(),h(e)}}function Ye(l,o){if(l&1&&(n(0,"span"),_(1,je,2,1,"span",42),t()),l&2){let e=c().$implicit;d(),g("ngForOf",e.tags)}}function He(l,o){l&1&&i(0,"No tags")}function Je(l,o){if(l&1&&(n(0,"option",51),i(1),t()),l&2){let e=o.$implicit;g("value",e.email),d(),J(" ",e.username," (",e.email,") ")}}function Qe(l,o){if(l&1){let e=b();n(0,"div",44)(1,"select",45),P("ngModelChange",function(r){m(e);let s=c(2);return v(s.selectedPatientEmail,r)||(s.selectedPatientEmail=r),p(r)}),n(2,"option",46),i(3,"Select patient email"),t(),_(4,Je,2,3,"option",47),t(),n(5,"button",48),u("click",function(){m(e);let r=c().$implicit,s=c();return p(s.shareImageToPatient(r))}),M(6,"i",49),i(7," Share "),t(),n(8,"button",50),u("click",function(){m(e);let r=c().$implicit;return p(r.showDropdown=!1)}),i(9," Cancel "),t()()}if(l&2){let e=c(2);d(),C("ngModel",e.selectedPatientEmail),d(3),g("ngForOf",e.assignedPatients)}}function qe(l,o){if(l&1){let e=b();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),_(5,We,2,1,"span",29),t(),n(6,"td"),i(7),Q(8,"date"),t(),n(9,"td"),_(10,Ye,2,1,"span",33)(11,He,1,0,"ng-template",null,1,xe),t(),n(13,"td")(14,"div",34)(15,"button",35),u("click",function(){let r=m(e).$implicit,s=c();return p(s.viewImage(r.name))}),M(16,"i",36),i(17," View "),t(),n(18,"button",37),u("click",function(){let r=m(e).$implicit,s=c();return p(s.toggleShareDropdown(r))}),M(19,"i",38),i(20," Share "),t(),n(21,"button",39),u("click",function(){let r=m(e).$implicit,s=c();return p(s.deleteImage(r))}),M(22,"i",40),i(23," Delete "),t()(),_(24,Qe,10,2,"div",41),t()()}if(l&2){let e=o.$implicit,a=ue(12);d(2),h(e.name),d(2),x("",e.uploadedBy," "),d(),g("ngIf",e.uploaderEmail),d(2),h(he(8,7,e.uploadedOn,"MMM d y, hh:mm:ss a","America/New_York")),d(3),g("ngIf",e.tags.length>0)("ngIfElse",a),d(14),g("ngIf",e.showDropdown)}}function Ge(l,o){l&1&&(n(0,"tr")(1,"td",52),i(2,"No uploaded images found."),t()())}function Ze(l,o){if(l&1){let e=b();n(0,"app-image-modal",53),u("closeModal",function(){m(e);let r=c();return p(r.closeModal())})("saveChanges",function(r){m(e);let s=c();return p(s.saveChanges(r))}),t()}if(l&2){let e=c();g("image",e.selectedImage)}}function Ke(l,o){if(l&1){let e=b();n(0,"div",54)(1,"div",55)(2,"h4",56),i(3,"Delete File"),t(),n(4,"p",57),i(5," Are you sure you want to delete "),n(6,"strong"),i(7),t(),i(8,"? "),t(),n(9,"div",58)(10,"button",59),u("click",function(){m(e);let r=c();return p(r.cancelDelete())}),i(11,"Cancel"),t(),n(12,"button",60),u("click",function(){m(e);let r=c();return p(r.confirmDelete())}),i(13,"Delete"),t()()()()}if(l&2){let e=c();d(7),h(e.imageToDelete==null?null:e.imageToDelete.name)}}var oe=class l{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3Service=a;this.snackBar=r}currentUserId=0;currentUserName=null;selectedImage=null;isEditing=!1;isLoading=!1;uploadedImages=[];newFileName="";newFileTags="";pendingFile=null;isDragging=!1;assignedPatients=[];selectedPatientEmail="";showDeleteModal=!1;imageToDelete=null;fileInput;ngOnInit(){let o=localStorage.getItem("user");if(o){let e=JSON.parse(o);this.currentUserId=Number(e.userId)||0,this.currentUserName=e.username||null}this.fetchUploadedImages(),this.loadAssignedPatients()}fetchUploadedImages(){this.isLoading=!0,this.s3Service.getUploadedFiles(this.currentUserId).subscribe(o=>{this.uploadedImages=o.files.map(e=>({name:e.fileName||"Unknown File",uploadedBy:e.uploadedBy||"Unknown",uploaderEmail:e.uploaderEmail||"",rawUploadedOn:e.uploadedOn,uploadedOn:e.uploadedOn?new Date(e.uploadedOn).toLocaleString("en-US",{timeZone:"America/New_York",month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):"N/A",tags:Array.isArray(e.tags)?e.tags:[],showDropdown:!1})).sort((e,a)=>new Date(a.rawUploadedOn).getTime()-new Date(e.rawUploadedOn).getTime()),this.isLoading=!1},o=>{console.error("\u274C ERROR: Failed to fetch uploaded files",o),this.isLoading=!1})}loadAssignedPatients(){this.s3Service.getPatientsByProvider(this.currentUserId).subscribe(o=>{this.assignedPatients=o.patients||[]},o=>{console.error("\u274C Failed to load assigned patients:",o)})}logout(){this.authService.logout(),this.router.navigate(["/login"])}viewImage(o){this.s3Service.getFileUrl(o,this.currentUserId).subscribe(e=>{this.selectedImage={name:o,viewUrl:e.viewUrl}},e=>{console.error("\u274C ERROR: Failed to generate view URL",e),this.snackBar.open("Unable to view image. Try again.")})}toggleShareDropdown(o){this.uploadedImages.forEach(e=>{e!==o&&(e.showDropdown=!1)}),o.showDropdown=!o.showDropdown}shareImageToPatient(o){let e=this.assignedPatients.find(r=>r.email===this.selectedPatientEmail);if(!e){this.snackBar.open("Please select a valid patient.");return}this.s3Service.shareFile(o.name,this.currentUserId,e.id,86400).subscribe(()=>{this.snackBar.open("\u2705 Image shared successfully!"),o.showDropdown=!1,this.selectedPatientEmail=""},r=>{console.error("\u274C Failed to share image",r),this.snackBar.open("\u274C Failed to share image.")})}shareImage(o,e){if(!e||e===0){this.snackBar.open("Invalid user ID for sharing.");return}this.s3Service.shareFile(o,this.currentUserId,e,86400).subscribe(r=>{this.snackBar.open(`\u2705 Image shared successfully with User ID: ${e}`),console.log("Shared Link:",r.viewUrl)},r=>{console.error("\u274C ERROR: Failed to share image",r),this.snackBar.open("Failed to share image. Please try again.")})}deleteImage(o){this.imageToDelete=o,this.showDeleteModal=!0}triggerFileInput(){this.fileInput.nativeElement.click()}uploadImage(o){let e=o.target;e.files&&e.files.length>0&&(this.pendingFile=e.files[0],this.newFileName=this.pendingFile.name)}confirmDelete(){this.imageToDelete&&(this.s3Service.deleteFile(this.imageToDelete.name,this.currentUserId).subscribe(()=>{this.snackBar.open("\u2705 File deleted successfully!"),this.fetchUploadedImages()},o=>{console.error("\u274C ERROR: Failed to delete file",o),this.snackBar.open("Failed to delete file. Please try again.")}),this.showDeleteModal=!1,this.imageToDelete=null)}cancelDelete(){this.showDeleteModal=!1,this.imageToDelete=null}confirmUpload(){if(!this.pendingFile){this.snackBar.open("Please select a file to upload.");return}if(!this.currentUserId||this.currentUserId===0){this.snackBar.open("You must be logged in to upload files.");return}let o=this.pendingFile.name,e=this.pendingFile.type,a=this.newFileTags?this.newFileTags.split(",").map(r=>r.trim()):[];this.s3Service.uploadFile(o,e,this.currentUserId,a).subscribe(r=>{r.uploadUrl&&fetch(r.uploadUrl,{method:"PUT",body:this.pendingFile,headers:{"Content-Type":e}}).then(()=>{this.snackBar.open("\u2705 File uploaded successfully!"),this.fetchUploadedImages(),this.resetUploadForm()}).catch(s=>{console.error("\u274C Upload error:",s),this.snackBar.open("Upload failed. Please try again.")})},r=>{console.error("\u274C ERROR: Failed to upload file",r),this.snackBar.open("Failed to upload file. Please try again.")})}handleDragOver(o){o.preventDefault(),this.isDragging=!0}handleDragLeave(){this.isDragging=!1}handleDrop(o){o.preventDefault(),this.isDragging=!1,o.dataTransfer&&o.dataTransfer.files.length>0&&(this.pendingFile=o.dataTransfer.files[0],this.newFileName=this.pendingFile.name)}resetUploadForm(){this.pendingFile=null,this.newFileName="",this.newFileTags="",this.fileInput&&this.fileInput.nativeElement&&(this.fileInput.nativeElement.value=""),this.isDragging=!1}closeModal(){this.selectedImage=null,this.isEditing=!1}saveChanges(o){if(this.selectedImage){let e=this.uploadedImages.findIndex(a=>a.name===this.selectedImage.name);e!==-1&&(this.uploadedImages[e]=E(E({},this.selectedImage),o))}this.selectedImage=null,this.isEditing=!1}static \u0275fac=function(e){return new(e||l)(f(w),f(O),f(V),f(N))};static \u0275cmp=S({type:l,selectors:[["app-uploaded-images"]],viewQuery:function(e,a){if(e&1&&me(Le,5),e&2){let r;pe(r=ge())&&(a.fileInput=r.first)}},decls:57,vars:12,consts:[["fileInput",""],["noTags",""],[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"uploaded-images-section"],[1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],[1,"drop-zone","border","p-4","mb-4","rounded","text-center",3,"dragover","dragleave","drop","ngClass"],[1,"fas","fa-cloud-upload-alt","fa-2x","text-primary","mb-2"],["class","mb-2",4,"ngIf"],[1,"btn","btn-success","btn-sm","mt-2",3,"click"],["type","file","accept",".jpeg,.jpg,.png,.pdf",2,"display","none",3,"change"],[1,"upload-controls","d-flex","align-items-center","gap-3","mb-4","flex-wrap"],[1,"me-2"],["type","text","placeholder","Enter tag(s)",1,"form-control","form-control-sm","w-auto",2,"min-width","200px",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[1,"fas","fa-upload"],[1,"table-responsive"],[1,"table","table-striped","align-middle","table-bordered"],[1,"table-primary"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"image","closeModal","saveChanges",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"mb-2"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-warning","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-share-alt"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-trash"],["class","d-flex flex-wrap gap-2 mt-2",4,"ngIf"],["class","me-1",4,"ngFor","ngForOf"],[1,"me-1"],[1,"d-flex","flex-wrap","gap-2","mt-2"],[1,"form-select","form-select-sm",2,"min-width","200px",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"fas","fa-paper-plane"],[1,"btn","btn-secondary","btn-sm",3,"click"],[3,"value"],["colspan","5",1,"text-center","text-muted"],[3,"closeModal","saveChanges","image"],[1,"modal-overlay"],[1,"modal-box"],[1,"modal-title"],[1,"modal-message"],[1,"modal-buttons"],[1,"modal-btn","cancel",3,"click"],[1,"modal-btn","delete",3,"click"]],template:function(e,a){if(e&1){let r=b();n(0,"div",2)(1,"h2"),i(2,"Provider Dashboard"),t(),n(3,"a",3),i(4,"Home"),t(),n(5,"a",4),i(6,"Patients"),t(),n(7,"a",5),i(8,"Uploaded Images"),t(),n(9,"a",6),i(10,"Shared Images"),t(),n(11,"a",7),i(12,"Profile"),t(),n(13,"a",8),u("click",function(){return m(r),p(a.logout())}),i(14,"Logout"),t()(),n(15,"div",9)(16,"div",10)(17,"div",11)(18,"div",12)(19,"h5",13),i(20,"Uploaded Images"),t(),n(21,"div",14),u("dragover",function(k){return m(r),p(a.handleDragOver(k))})("dragleave",function(){return m(r),p(a.handleDragLeave())})("drop",function(k){return m(r),p(a.handleDrop(k))}),M(22,"i",15),_(23,ze,3,0,"p",16)(24,Ae,3,1,"p",16),n(25,"button",17),u("click",function(){return m(r),p(a.triggerFileInput())}),i(26,"Select File"),t(),n(27,"input",18,0),u("change",function(k){return m(r),p(a.uploadImage(k))}),t()(),n(29,"div",19)(30,"span",20)(31,"strong"),i(32,"File Name:"),t(),i(33),t(),n(34,"input",21),P("ngModelChange",function(k){return m(r),v(a.newFileTags,k)||(a.newFileTags=k),p(k)}),t(),n(35,"button",22),u("click",function(){return m(r),p(a.confirmUpload())}),M(36,"i",23),i(37," Upload "),t()(),n(38,"div",24)(39,"table",25)(40,"thead",26)(41,"tr")(42,"th"),i(43,"Image Name"),t(),n(44,"th"),i(45,"Uploaded By"),t(),n(46,"th"),i(47,"Uploaded On"),t(),n(48,"th"),i(49,"Tag(s)"),t(),n(50,"th",27),i(51,"Actions"),t()()(),n(52,"tbody"),_(53,qe,25,11,"tr",28)(54,Ge,3,0,"tr",29),t()()(),_(55,Ze,1,1,"app-image-modal",30)(56,Ke,14,1,"div",31),t()()()()}e&2&&(d(21),g("ngClass",fe(10,Be,a.isDragging)),d(2),g("ngIf",!a.pendingFile),d(),g("ngIf",a.pendingFile),d(9),x(" ",(a.pendingFile==null?null:a.pendingFile.name)||"No file selected",""),d(),C("ngModel",a.newFileTags),d(),g("disabled",!a.pendingFile),d(18),g("ngForOf",a.uploadedImages),d(),g("ngIf",a.uploadedImages.length===0),d(),g("ngIf",a.selectedImage),d(),g("ngIf",a.showDeleteModal))},dependencies:[R,be,F,T,q,I,y,U,W,j,L,A,B,z,G],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#0006;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;width:90%;max-width:420px;text-align:left;box-shadow:0 5px 20px #0003}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.modal-message[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:1.5rem;color:#333}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.modal-btn[_ngcontent-%COMP%]{padding:.5rem 1.5rem;border:none;border-radius:6px;font-size:.9rem;cursor:pointer}.modal-btn.cancel[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.modal-btn.delete[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}"]})};function Xe(l,o){if(l&1){let e=b();n(0,"div",10)(1,"div",11)(2,"h2"),i(3),t()(),n(4,"div",12)(5,"p")(6,"strong"),i(7,"Email:"),t(),i(8),t(),n(9,"p")(10,"strong"),i(11,"Date of Birth:"),t(),i(12),Q(13,"date"),t(),n(14,"p")(15,"strong"),i(16,"Country:"),t(),i(17),t(),n(18,"p")(19,"strong"),i(20,"State/City:"),t(),i(21),t(),n(22,"p")(23,"strong"),i(24,"Age:"),t(),i(25),t(),n(26,"p")(27,"strong"),i(28,"Weight:"),t(),i(29),t(),n(30,"p")(31,"strong"),i(32,"Height:"),t(),i(33),t(),n(34,"p")(35,"strong"),i(36,"Address:"),t(),i(37),t(),n(38,"p")(39,"strong"),i(40,"Phone:"),t(),i(41),t(),n(42,"button",13),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),i(43,"Edit Profile"),t()()()}if(l&2){let e=c();d(3),h(e.provider.name||"No name"),d(5),x(" ",e.provider.email,""),d(4),x(" ",_e(13,10,e.provider.dobFormatted,"MMM d y"),""),d(5),x(" ",e.getCountryName(e.provider.country)||"Not set",""),d(4),x(" ",e.provider.state||"Not set",""),d(4),x(" ",e.provider.age?e.provider.age+" Years":"Not set",""),d(4),x(" ",e.provider.weight?e.provider.weight+" lbs":"Not set",""),d(4),x(" ",e.provider.height?e.provider.height+" cm":"Not set",""),d(4),x(" ",e.provider.address||"Not set",""),d(4),x(" ",(e.provider.phone==null?null:e.provider.phone.internationalNumber)||e.provider.phone||"Not set","")}}function $e(l,o){if(l&1&&(n(0,"option",41),i(1),t()),l&2){let e=o.$implicit;g("value",e.isoCode),d(),x(" ",e.name," ")}}function et(l,o){if(l&1&&(n(0,"option",41),i(1),t()),l&2){let e=o.$implicit;g("value",e.name),d(),h(e.name)}}function tt(l,o){if(l&1){let e=b();n(0,"div",10)(1,"h3"),i(2,"Edit Profile"),t(),n(3,"form",14),u("ngSubmit",function(){m(e);let r=c();return p(r.saveChanges())}),n(4,"div",15)(5,"label",16),i(6,"Name:"),t(),n(7,"input",17),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.name,r)||(s.provider.name=r),p(r)}),t()(),n(8,"div",15)(9,"label",18),i(10,"Email:"),t(),M(11,"input",19),t(),n(12,"div",15)(13,"label",20),i(14,"Date of Birth:"),t(),n(15,"input",21),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.dob,r)||(s.provider.dob=r),p(r)}),t()(),n(16,"div",15)(17,"label",22),i(18,"Country:"),t(),n(19,"select",23),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.country,r)||(s.provider.country=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getStates(r.provider.country))}),n(20,"option",24),i(21,"Select Country"),t(),_(22,$e,2,2,"option",25),t()(),n(23,"div",15)(24,"label",26),i(25,"State/City:"),t(),n(26,"select",27),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.state,r)||(s.provider.state=r),p(r)}),u("change",function(){m(e);let r=c();return p(r.getCities(r.provider.state))}),n(27,"option",24),i(28,"Select State/City"),t(),_(29,et,2,2,"option",25),t()(),n(30,"div",15)(31,"label",28),i(32,"Age:"),t(),n(33,"input",29),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.age,r)||(s.provider.age=r),p(r)}),t()(),n(34,"div",15)(35,"label",30),i(36,"Weight (lbs):"),t(),n(37,"input",31),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.weight,r)||(s.provider.weight=r),p(r)}),t()(),n(38,"div",15)(39,"label",32),i(40,"Height (cm):"),t(),n(41,"input",33),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.height,r)||(s.provider.height=r),p(r)}),t()(),n(42,"div",15)(43,"label",34),i(44,"Address:"),t(),n(45,"input",35),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.address,r)||(s.provider.address=r),p(r)}),t()(),n(46,"div",15)(47,"label",36),i(48,"Phone Number:"),t(),n(49,"ngx-intl-tel-input",37),P("ngModelChange",function(r){m(e);let s=c();return v(s.provider.phone,r)||(s.provider.phone=r),p(r)}),t()(),n(50,"div",38)(51,"button",39),i(52,"Save Changes"),t(),i(53,"\xA0 "),n(54,"button",40),u("click",function(){m(e);let r=c();return p(r.toggleEdit())}),i(55,"Cancel"),t()()()()}if(l&2){let e=c();d(7),C("ngModel",e.provider.name),d(4),g("value",e.provider.email),d(4),C("ngModel",e.provider.dob),d(4),C("ngModel",e.provider.country),d(3),g("ngForOf",e.countries),d(4),C("ngModel",e.provider.state),d(3),g("ngForOf",e.states),d(4),C("ngModel",e.provider.age),d(4),C("ngModel",e.provider.weight),d(4),C("ngModel",e.provider.height),d(4),C("ngModel",e.provider.address),d(4),g("cssClass","form-control full-width")("preferredCountries",e.preferredCountries)("enableAutoCountrySelect",!0)("enablePlaceholder",!0)("searchCountryFlag",!0)("searchCountryField",e.searchFields)("selectFirstCountry",!1)("selectedCountryISO",e.provider.country||e.countryISO.UnitedStates)("separateDialCode",!0)("phoneValidation",!0),C("ngModel",e.provider.phone)}}var re=class l{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3FileService=a;this.snackBar=r}countries=[];states=[];cities=[];provider={email:"",name:"",dob:"",dobFormatted:"",state:"",country:"",age:0,weight:0,height:"",address:"",phone:null};isEditing=!1;currentUserId=0;searchCountryField=X;countryISO=K;phoneNumberFormat=Ie;searchFields=[X.Iso2,X.Name];preferredCountries=[K.UnitedStates];selectedCountryISO=K.UnitedStates;ngOnInit(){let o=JSON.parse(localStorage.getItem("user")||"{}");this.currentUserId=o.userId,this.currentUserId&&(this.getCountries(),this.fetchProfile())}fetchProfile(){this.s3FileService.getUserById(this.currentUserId).subscribe(o=>{let e=o.country||"",a=o.phone?{number:o.phone,internationalNumber:o.phone,nationalNumber:o.phone,e164Number:o.phone,countryCode:"",dialCode:""}:null;this.provider=H(E(E({},this.provider),o),{country:o.country,dob:o.dob||"",dobFormatted:o.dob||"",phone:a}),e&&(this.getStates(e),this.selectedCountryISO=e)},o=>{console.error("\u274C Failed to fetch profile",o)})}getCountries(){this.countries=Z.getAllCountries()}getCountryName(o){return Z.getCountryByCode(o)?.name||o}getStates(o){this.states=Oe.getStatesOfCountry(o),this.cities=[],this.selectedCountryISO=o}getCities(o){let e=this.provider.country;this.cities=ye.getCitiesOfState(e,o)}toggleEdit(){this.isEditing=!this.isEditing}saveChanges(){let o=E({},this.provider),e=Z.getAllCountries().find(a=>a.isoCode.toLowerCase()===this.provider.country.toLowerCase()||a.name.toLowerCase()===this.provider.country.toLowerCase());o.country=e?.isoCode||this.provider.country,o.phone=this.provider.phone?.internationalNumber||"",this.s3FileService.updateUserProfile(this.currentUserId,o).subscribe(()=>{console.log("\u2705 Profile saved"),this.snackBar.open("\u2705 Profile updated!","Close",{duration:3e3}),this.toggleEdit(),this.fetchProfile()},a=>{console.error("\u274C Failed to save profile:",a),this.snackBar.open("\u274C Failed to update profile.","Close",{duration:3e3})})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(f(w),f(O),f(V),f(N))};static \u0275cmp=S({type:l,selectors:[["app-provider-profile"]],decls:19,vars:2,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"profile-container"],["class","card",4,"ngIf"],[1,"card"],[1,"profile-header"],[1,"profile-details"],[1,"edit-button",3,"click"],[3,"ngSubmit"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","required","",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email","name","email","disabled","",1,"readonly",3,"value"],["for","dob"],["type","date","id","dob","name","dob",3,"ngModelChange","ngModel"],["for","country"],["id","country","name","country",3,"ngModelChange","change","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","state"],["id","state","name","state",3,"ngModelChange","change","ngModel"],["for","age"],["type","number","id","age","name","age",3,"ngModelChange","ngModel"],["for","weight"],["type","number","id","weight","name","weight",3,"ngModelChange","ngModel"],["for","height"],["type","text","id","height","name","height",3,"ngModelChange","ngModel"],["for","address"],["type","text","id","address","name","address",3,"ngModelChange","ngModel"],["for","phone"],["name","phone","id","phone",3,"ngModelChange","cssClass","preferredCountries","enableAutoCountrySelect","enablePlaceholder","searchCountryFlag","searchCountryField","selectFirstCountry","selectedCountryISO","separateDialCode","phoneValidation","ngModel"],[1,"form-buttons"],["type","submit",1,"save-button"],["type","button",1,"cancel-button",3,"click"],[3,"value"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),i(2,"Provider Dashboard"),t(),n(3,"a",1),i(4,"Home"),t(),n(5,"a",2),i(6,"Patients"),t(),n(7,"a",3),i(8,"Uploaded Images"),t(),n(9,"a",4),i(10,"Shared Images"),t(),n(11,"a",5),i(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),i(14,"Logout"),t()(),n(15,"div",7)(16,"div",8),_(17,Xe,44,13,"div",9)(18,tt,56,22,"div",9),t()()),e&2&&(d(17),g("ngIf",!a.isEditing),d(),g("ngIf",a.isEditing))},dependencies:[I,y,U,Pe,W,j,L,Me,A,B,Ce,Se,z,ve,R,F,T,q,Ee,ke,we],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.profile-container[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:8px;box-shadow:0 4px 10px #0000001a;max-width:800px;margin:20px auto}.card[_ngcontent-%COMP%]{background-color:#ecf0f1;padding:20px;border-radius:8px;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:20px}.profile-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:120px;height:120px;margin-bottom:15px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;color:#34495e;text-align:center}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;line-height:1.6;margin:8px 0;color:#7f8c8d}.edit-button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:10px 20px;cursor:pointer;border-radius:4px;font-size:1rem;transition:background-color .3s ease}.edit-button[_ngcontent-%COMP%]:hover{background-color:#2980b9}form[_ngcontent-%COMP%]{display:grid;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:5px;color:#34495e}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:12px;font-size:1rem;border-radius:4px;border:1px solid #bdc3c7;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db}button[_ngcontent-%COMP%]{padding:12px 20px;font-size:1rem;border:none;cursor:pointer;border-radius:4px;transition:background-color .3s ease}.save-button[_ngcontent-%COMP%]{background-color:#2ecc71;color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:#27ae60}.cancel-button[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff}.cancel-button[_ngcontent-%COMP%]:hover{background-color:#c0392b}button[_ngcontent-%COMP%]:focus{outline:none}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:20px}@media screen and (max-width: 768px){.sidebar[_ngcontent-%COMP%]{width:200px}.main-content[_ngcontent-%COMP%]{margin-left:220px;width:calc(100% - 220px)}.profile-container[_ngcontent-%COMP%]{padding:20px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}.profile-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}}.form-group[_ngcontent-%COMP%]   ngx-intl-tel-input[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%}"]})};var ce=Te(Re());function nt(l,o){l&1&&(n(0,"div",16),M(1,"i",17),i(2," Loading shared images... "),t())}function it(l,o){if(l&1&&(n(0,"span"),i(1),t()),l&2){let e=c().$implicit;d(),x("(",e.sharedWithEmail,")")}}function ot(l,o){if(l&1){let e=b();n(0,"tr")(1,"td"),i(2),t(),n(3,"td"),i(4),_(5,it,2,1,"span",23),t(),n(6,"td"),i(7),t(),n(8,"td"),i(9),t(),n(10,"td",24)(11,"div",25)(12,"button",26),u("click",function(){let r=m(e).$implicit,s=c(2);return p(s.viewImage(r))}),M(13,"i",27),i(14," View "),t(),n(15,"button",28),u("click",function(){let r=m(e).$implicit,s=c(2);return p(s.revokeAccess(r))}),M(16,"i",29),i(17," Revoke "),t()()()()}if(l&2){let e=o.$implicit;d(2),h(e.name),d(2),x(" ",e.sharedWithName," "),d(),g("ngIf",e.sharedWithEmail),d(2),h(e.sharedOn),d(2),h(e.expiresAt)}}function rt(l,o){l&1&&(n(0,"tr")(1,"td",30),i(2,"No shared images found."),t()())}function at(l,o){if(l&1&&(n(0,"div",18)(1,"table",19)(2,"thead",20)(3,"tr")(4,"th"),i(5,"Image Name"),t(),n(6,"th"),i(7,"Shared With"),t(),n(8,"th"),i(9,"Shared On"),t(),n(10,"th"),i(11,"Expires On"),t(),n(12,"th",21),i(13,"Actions"),t()()(),n(14,"tbody"),_(15,ot,18,5,"tr",22)(16,rt,3,0,"tr",23),t()()()),l&2){let e=c();d(15),g("ngForOf",e.sharedImages),d(),g("ngIf",e.sharedImages.length===0)}}function lt(l,o){if(l&1){let e=b();n(0,"app-image-modal",31),u("closeModal",function(){m(e);let r=c();return p(r.closeModal())}),t()}if(l&2){let e=c();g("image",e.selectedImage)("isEditing",!1)}}function dt(l,o){if(l&1){let e=b();n(0,"div",32)(1,"div",33)(2,"h4",34),i(3,"Revoke Access"),t(),n(4,"p",35),i(5," Are you sure you want to revoke access to "),n(6,"strong"),i(7),t(),i(8," from "),n(9,"strong"),i(10),t(),i(11," ("),n(12,"span",36),i(13),t(),i(14,")? "),t(),n(15,"div",37)(16,"button",38),u("click",function(){m(e);let r=c();return p(r.cancelRevoke())}),i(17,"Cancel"),t(),n(18,"button",39),u("click",function(){m(e);let r=c();return p(r.confirmRevoke())}),i(19,"Revoke"),t()()()()}if(l&2){let e=c();d(7),h(e.imageToRevoke==null?null:e.imageToRevoke.name),d(3),h(e.imageToRevoke==null?null:e.imageToRevoke.sharedWithName),d(3),h(e.imageToRevoke==null?null:e.imageToRevoke.sharedWithEmail)}}var ae=class l{constructor(o,e,a,r){this.authService=o;this.router=e;this.s3Service=a;this.snackBar=r}sharedImages=[];currentUserId=0;currentUserEmail=null;selectedImage=null;isLoading=!1;showRevokeModal=!1;imageToRevoke=null;ngOnInit(){console.log("\u{1F4CC} Initializing Shared Images Component...");let o=localStorage.getItem("user");if(o){let e=JSON.parse(o);this.currentUserId=e.userId??0,this.currentUserEmail=e.email}if(!this.currentUserId){console.error("\u274C ERROR: No valid user ID found.");return}console.log("\u2705 Current Provider ID:",this.currentUserId),this.fetchSharedFiles()}fetchSharedFiles(){if(!this.currentUserId){console.error("\u274C ERROR: No provider ID found.");return}this.s3Service.getProviderSharedFiles(this.currentUserId).subscribe(o=>{console.log("\u2705 Shared Files Response:",o),this.sharedImages=o.sharedFiles.map(e=>({name:e.file_name,sharedBy:e.uploaded_by,sharedByEmail:e.shared_by_email,sharedWith:e.shared_with,sharedWithName:e.shared_with_name,sharedWithEmail:e.shared_with_email,sharedOn:e.shared_on?ce.utc(e.shared_on).local().format("MMM D YYYY, hh:mm:ss A"):"N/A",expiresAt:e.expires_at?ce.utc(e.expires_at).local().format("MMM D YYYY, hh:mm:ss A"):"N/A"})),console.log("\u{1F4CC} Updated Shared Images List:",this.sharedImages)},o=>{console.error("\u274C ERROR: Failed to fetch shared files",o)})}viewImage(o){this.s3Service.getFileUrl(o.name,o.sharedBy).subscribe(e=>{this.selectedImage=H(E({},o),{viewUrl:e.viewUrl})},e=>{console.error("\u274C ERROR: Failed to generate view URL",e),this.snackBar.open("Unable to view image. Try again.")})}closeModal(){this.selectedImage=null}revokeAccess(o){this.imageToRevoke=o,this.showRevokeModal=!0}confirmRevoke(){if(!this.imageToRevoke||!this.currentUserId)return;let o=Number(this.imageToRevoke.sharedWith);if(isNaN(o)){console.error("\u274C ERROR: Invalid patient ID (expected a number)");return}this.s3Service.revokeSharedFile(this.imageToRevoke.name,this.currentUserId,o).subscribe(()=>{this.snackBar.open("\u2705 Access revoked successfully!"),this.fetchSharedFiles()},e=>{console.error("\u274C ERROR: Failed to revoke access",e),this.snackBar.open("\u274C Failed to revoke access. Please try again.")}),this.showRevokeModal=!1,this.imageToRevoke=null}cancelRevoke(){this.showRevokeModal=!1,this.imageToRevoke=null}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||l)(f(w),f(O),f(V),f(N))};static \u0275cmp=S({type:l,selectors:[["app-shared-images"]],decls:25,vars:4,consts:[[1,"sidebar"],["routerLink","/provider/dashboard"],["routerLink","/provider/patients"],["routerLink","/provider/uploaded-images"],["routerLink","/provider/shared-images"],["routerLink","/provider/profile"],["href","#",3,"click"],[1,"main-content"],[1,"uploaded-images-section"],[1,"card","shadow-sm","rounded"],[1,"card-body"],[1,"mb-3"],["class","loading-spinner mb-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[3,"image","isEditing","closeModal",4,"ngIf"],["class","modal-overlay",4,"ngIf"],[1,"loading-spinner","mb-3"],[1,"fas","fa-spinner","fa-spin"],[1,"table-responsive"],[1,"table","table-striped","table-bordered","align-middle"],[1,"table-primary"],[1,"text-center",2,"width","200px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-center"],[1,"d-flex","justify-content-center","align-items-center","flex-wrap","gap-1"],[1,"btn","btn-primary","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-eye"],[1,"btn","btn-danger","btn-sm",2,"font-size","0.87rem","padding","2px 8px",3,"click"],[1,"fas","fa-trash"],["colspan","5",1,"text-center","text-muted"],[3,"closeModal","image","isEditing"],[1,"modal-overlay"],[1,"modal-box"],[1,"modal-title"],[1,"modal-message"],[1,"text-muted"],[1,"modal-buttons"],[1,"modal-btn","cancel",3,"click"],[1,"modal-btn","delete",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h2"),i(2,"Provider Dashboard"),t(),n(3,"a",1),i(4,"Home"),t(),n(5,"a",2),i(6,"Patients"),t(),n(7,"a",3),i(8,"Uploaded Images"),t(),n(9,"a",4),i(10,"Shared Images"),t(),n(11,"a",5),i(12,"Profile"),t(),n(13,"a",6),u("click",function(){return a.logout()}),i(14,"Logout"),t()(),n(15,"div",7)(16,"div",8)(17,"div",9)(18,"div",10)(19,"h5",11),i(20,"Shared Images"),t(),_(21,nt,3,0,"div",12)(22,at,17,2,"div",13)(23,lt,1,2,"app-image-modal",14)(24,dt,20,3,"div",15),t()()()()),e&2&&(d(21),g("ngIf",a.isLoading),d(),g("ngIf",!a.isLoading),d(),g("ngIf",a.selectedImage),d(),g("ngIf",a.showRevokeModal))},dependencies:[R,F,T,I,y,U,G],styles:["body[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f9f9f9;margin:0;padding:0}.sidebar[_ngcontent-%COMP%]{width:250px;height:100vh;background-color:#2c3e50;color:#fff;position:fixed;top:0;left:0;display:flex;flex-direction:column;padding:20px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.5rem;text-align:center}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;margin:10px 0;padding:10px;border-radius:5px;transition:background-color .3s ease}.sidebar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1a252f}.main-content[_ngcontent-%COMP%]{margin-left:250px;padding:20px}.uploaded-images-section[_ngcontent-%COMP%]{margin-top:20px}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #007bff;padding:20px;text-align:center;border-radius:10px;background-color:#f8f9fa;cursor:pointer}.upload-zone[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.upload-zone.active[_ngcontent-%COMP%]{background-color:#d0e6fa;border-color:#1a66b9}.file-input[_ngcontent-%COMP%]{display:none}.file-label[_ngcontent-%COMP%]{display:inline-block;padding:10px 15px;background-color:#3498db;color:#fff;border-radius:5px;cursor:pointer;transition:background-color .3s ease;text-align:center;margin-top:10px}.file-label[_ngcontent-%COMP%]:hover{background-color:#2980b9}.file-name-input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:1rem;margin-top:10px}.file-name-input[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 5px #3498db80}.upload-controls[_ngcontent-%COMP%]{margin-top:20px;display:flex;gap:10px;align-items:center}.upload-btn[_ngcontent-%COMP%]{margin-left:10px}.uploaded-images-table[_ngcontent-%COMP%]{margin-top:30px}.uploaded-images-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .uploaded-images-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left}.uploaded-images-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.uploaded-images-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.uploaded-images-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}.app-image-modal[_ngcontent-%COMP%]{width:600px;background-color:#fff;border-radius:5px;padding:20px;box-shadow:0 2px 4px #0000001a}.small-tag-input[_ngcontent-%COMP%]{width:auto!important;max-width:200px!important;padding:5px 10px!important;font-size:14px!important}.table-responsive[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:12px;text-align:left;font-weight:500}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f2f2f2}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}.tag-text[_ngcontent-%COMP%]{font-size:1rem;font-weight:400;color:#000}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:10px;padding:30px;text-align:center;margin-bottom:20px;transition:background-color .3s;background-color:#f9f9f9}.drop-zone.dragging[_ngcontent-%COMP%]{background-color:#e6f7ff}.drop-zone-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;margin-bottom:10px}.drop-zone-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:40px;color:#007bff}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-box[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;width:90%;max-width:420px;box-shadow:0 5px 20px #0003;text-align:left}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.modal-message[_ngcontent-%COMP%]{font-size:.95rem;margin-bottom:1.5rem;color:#333}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.modal-btn[_ngcontent-%COMP%]{padding:.5rem 1.25rem;font-size:.9rem;border:none;border-radius:6px;cursor:pointer}.modal-btn.cancel[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.modal-btn.delete[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}"]})};var Jt=[{path:"",component:Y,canActivate:[D],data:{role:"provider"}},{path:"dashboard",component:Y,canActivate:[D],data:{role:"provider"}},{path:"patients",component:ie,canActivate:[D],data:{role:"provider"}},{path:"uploaded-images",component:oe,canActivate:[D],data:{role:"provider"}},{path:"shared-images",component:ae,canActivate:[D],data:{role:"provider"}},{path:"profile",component:re,canActivate:[D],data:{role:"provider"}}];export{Jt as PROVIDER_ROUTES};
